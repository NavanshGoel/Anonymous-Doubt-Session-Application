{"ast":null,"code":"\"use strict\";\n\nconst vm = require(\"vm\");\n\nconst webIDLConversions = require(\"webidl-conversions\");\n\nconst {\n  CSSStyleDeclaration\n} = require(\"cssstyle\");\n\nconst {\n  Performance: RawPerformance\n} = require(\"w3c-hr-time\");\n\nconst notImplemented = require(\"./not-implemented\");\n\nconst {\n  installInterfaces\n} = require(\"../living/interfaces\");\n\nconst {\n  define,\n  mixin\n} = require(\"../utils\");\n\nconst Element = require(\"../living/generated/Element\");\n\nconst EventTarget = require(\"../living/generated/EventTarget\");\n\nconst EventHandlerNonNull = require(\"../living/generated/EventHandlerNonNull\");\n\nconst OnBeforeUnloadEventHandlerNonNull = require(\"../living/generated/OnBeforeUnloadEventHandlerNonNull\");\n\nconst OnErrorEventHandlerNonNull = require(\"../living/generated/OnErrorEventHandlerNonNull\");\n\nconst PageTransitionEvent = require(\"../living/generated/PageTransitionEvent\");\n\nconst namedPropertiesWindow = require(\"../living/named-properties-window\");\n\nconst postMessage = require(\"../living/post-message\");\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\n\nconst {\n  btoa,\n  atob\n} = require(\"abab\");\n\nconst idlUtils = require(\"../living/generated/utils\");\n\nconst WebSocketImpl = require(\"../living/websockets/WebSocket-impl\").implementation;\n\nconst BarProp = require(\"../living/generated/BarProp\");\n\nconst documents = require(\"../living/documents.js\");\n\nconst External = require(\"../living/generated/External\");\n\nconst Navigator = require(\"../living/generated/Navigator\");\n\nconst Performance = require(\"../living/generated/Performance\");\n\nconst Screen = require(\"../living/generated/Screen\");\n\nconst Storage = require(\"../living/generated/Storage\");\n\nconst Selection = require(\"../living/generated/Selection\");\n\nconst reportException = require(\"../living/helpers/runtime-script-errors\");\n\nconst {\n  getCurrentEventHandlerValue\n} = require(\"../living/helpers/create-event-accessor.js\");\n\nconst {\n  fireAnEvent\n} = require(\"../living/helpers/events\");\n\nconst SessionHistory = require(\"../living/window/SessionHistory\");\n\nconst {\n  forEachMatchingSheetRuleOfElement,\n  getResolvedValue,\n  propertiesWithResolvedValueImplemented,\n  SHADOW_DOM_PSEUDO_REGEXP\n} = require(\"../living/helpers/style-rules.js\");\n\nconst CustomElementRegistry = require(\"../living/generated/CustomElementRegistry\");\n\nconst jsGlobals = require(\"./js-globals.json\");\n\nconst GlobalEventHandlersImpl = require(\"../living/nodes/GlobalEventHandlers-impl\").implementation;\n\nconst WindowEventHandlersImpl = require(\"../living/nodes/WindowEventHandlers-impl\").implementation;\n\nconst events = new Set([// GlobalEventHandlers\n\"abort\", \"autocomplete\", \"autocompleteerror\", \"blur\", \"cancel\", \"canplay\", \"canplaythrough\", \"change\", \"click\", \"close\", \"contextmenu\", \"cuechange\", \"dblclick\", \"drag\", \"dragend\", \"dragenter\", \"dragleave\", \"dragover\", \"dragstart\", \"drop\", \"durationchange\", \"emptied\", \"ended\", \"focus\", \"input\", \"invalid\", \"keydown\", \"keypress\", \"keyup\", \"load\", \"loadeddata\", \"loadedmetadata\", \"loadstart\", \"mousedown\", \"mouseenter\", \"mouseleave\", \"mousemove\", \"mouseout\", \"mouseover\", \"mouseup\", \"wheel\", \"pause\", \"play\", \"playing\", \"progress\", \"ratechange\", \"reset\", \"resize\", \"scroll\", \"securitypolicyviolation\", \"seeked\", \"seeking\", \"select\", \"sort\", \"stalled\", \"submit\", \"suspend\", \"timeupdate\", \"toggle\", \"volumechange\", \"waiting\", // WindowEventHandlers\n\"afterprint\", \"beforeprint\", \"hashchange\", \"languagechange\", \"message\", \"messageerror\", \"offline\", \"online\", \"pagehide\", \"pageshow\", \"popstate\", \"rejectionhandled\", \"storage\", \"unhandledrejection\", \"unload\" // \"error\" and \"beforeunload\" are added separately\n]);\n\nexports.createWindow = function (options) {\n  return new Window(options);\n};\n\nconst jsGlobalEntriesToInstall = Object.entries(jsGlobals).filter(([name]) => name in global); // TODO remove when we drop Node v10 support.\n\nconst anyNodeVersionQueueMicrotask = typeof queueMicrotask === \"function\" ? queueMicrotask : process.nextTick; // https://html.spec.whatwg.org/#the-window-object\n\nfunction setupWindow(windowInstance, {\n  runScripts\n}) {\n  if (runScripts === \"outside-only\" || runScripts === \"dangerously\") {\n    contextifyWindow(windowInstance); // Without this, these globals will only appear to scripts running inside the context using vm.runScript; they will\n    // not appear to scripts running from the outside, including to JSDOM implementation code.\n\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc,\n        value: vm.runInContext(globalName, windowInstance)\n      };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  } else {\n    // Without contextifying the window, none of the globals will exist. So, let's at least alias them from the Node.js\n    // context. See https://github.com/jsdom/jsdom/issues/2727 for more background and discussion.\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc,\n        value: global[globalName]\n      };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  }\n\n  installInterfaces(windowInstance, [\"Window\"]);\n  const EventTargetConstructor = windowInstance.EventTarget; // eslint-disable-next-line func-name-matching, func-style, no-shadow\n\n  const windowConstructor = function Window() {\n    throw new TypeError(\"Illegal constructor\");\n  };\n\n  Object.setPrototypeOf(windowConstructor, EventTargetConstructor);\n  Object.defineProperty(windowInstance, \"Window\", {\n    configurable: true,\n    writable: true,\n    value: windowConstructor\n  });\n  const windowPrototype = Object.create(EventTargetConstructor.prototype);\n  Object.defineProperties(windowPrototype, {\n    constructor: {\n      value: windowConstructor,\n      writable: true,\n      configurable: true\n    },\n    [Symbol.toStringTag]: {\n      value: \"Window\",\n      configurable: true\n    }\n  });\n  windowConstructor.prototype = windowPrototype;\n  Object.setPrototypeOf(windowInstance, windowPrototype);\n  EventTarget.setup(windowInstance, windowInstance);\n  mixin(windowInstance, WindowEventHandlersImpl.prototype);\n  mixin(windowInstance, GlobalEventHandlersImpl.prototype);\n\n  windowInstance._initGlobalEvents();\n\n  Object.defineProperty(windowInstance, \"onbeforeunload\", {\n    configurable: true,\n    enumerable: true,\n\n    get() {\n      return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, \"beforeunload\"));\n    },\n\n    set(V) {\n      if (!idlUtils.isObject(V)) {\n        V = null;\n      } else {\n        V = OnBeforeUnloadEventHandlerNonNull.convert(V, {\n          context: \"Failed to set the 'onbeforeunload' property on 'Window': The provided value\"\n        });\n      }\n\n      this._setEventHandlerFor(\"beforeunload\", V);\n    }\n\n  });\n  Object.defineProperty(windowInstance, \"onerror\", {\n    configurable: true,\n    enumerable: true,\n\n    get() {\n      return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, \"error\"));\n    },\n\n    set(V) {\n      if (!idlUtils.isObject(V)) {\n        V = null;\n      } else {\n        V = OnErrorEventHandlerNonNull.convert(V, {\n          context: \"Failed to set the 'onerror' property on 'Window': The provided value\"\n        });\n      }\n\n      this._setEventHandlerFor(\"error\", V);\n    }\n\n  });\n\n  for (const event of events) {\n    Object.defineProperty(windowInstance, `on${event}`, {\n      configurable: true,\n      enumerable: true,\n\n      get() {\n        return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, event));\n      },\n\n      set(V) {\n        if (!idlUtils.isObject(V)) {\n          V = null;\n        } else {\n          V = EventHandlerNonNull.convert(V, {\n            context: `Failed to set the 'on${event}' property on 'Window': The provided value`\n          });\n        }\n\n        this._setEventHandlerFor(event, V);\n      }\n\n    });\n  }\n\n  windowInstance._globalObject = windowInstance;\n} // NOTE: per https://heycam.github.io/webidl/#Global, all properties on the Window object must be own-properties.\n// That is why we assign everything inside of the constructor, instead of using a shared prototype.\n// You can verify this in e.g. Firefox or Internet Explorer, which do a good job with Web IDL compliance.\n\n\nfunction Window(options) {\n  setupWindow(this, {\n    runScripts: options.runScripts\n  });\n  const rawPerformance = new RawPerformance();\n  const windowInitialized = rawPerformance.now();\n  const window = this; // ### PRIVATE DATA PROPERTIES\n\n  this._resourceLoader = options.resourceLoader; // vm initialization is deferred until script processing is activated\n\n  this._globalProxy = this;\n  Object.defineProperty(idlUtils.implForWrapper(this), idlUtils.wrapperSymbol, {\n    get: () => this._globalProxy\n  }); // List options explicitly to be clear which are passed through\n\n  this._document = documents.createWrapper(window, {\n    parsingMode: options.parsingMode,\n    contentType: options.contentType,\n    encoding: options.encoding,\n    cookieJar: options.cookieJar,\n    url: options.url,\n    lastModified: options.lastModified,\n    referrer: options.referrer,\n    concurrentNodeIterators: options.concurrentNodeIterators,\n    parseOptions: options.parseOptions,\n    defaultView: this._globalProxy,\n    global: this,\n    parentOrigin: options.parentOrigin\n  }, {\n    alwaysUseDocumentClass: true\n  });\n\n  if (vm.isContext(window)) {\n    const documentImpl = idlUtils.implForWrapper(window._document);\n    documentImpl._defaultView = window._globalProxy = vm.runInContext(\"this\", window);\n  }\n\n  const documentOrigin = idlUtils.implForWrapper(this._document)._origin;\n\n  this._origin = documentOrigin; // https://html.spec.whatwg.org/#session-history\n\n  this._sessionHistory = new SessionHistory({\n    document: idlUtils.implForWrapper(this._document),\n    url: idlUtils.implForWrapper(this._document)._URL,\n    stateObject: null\n  }, this);\n  this._virtualConsole = options.virtualConsole;\n  this._runScripts = options.runScripts; // Set up the window as if it's a top level window.\n  // If it's not, then references will be corrected by frame/iframe code.\n\n  this._parent = this._top = this._globalProxy;\n  this._frameElement = null; // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement implementation.\n\n  this._length = 0; // https://dom.spec.whatwg.org/#window-current-event\n\n  this._currentEvent = undefined;\n  this._pretendToBeVisual = options.pretendToBeVisual;\n  this._storageQuota = options.storageQuota; // Some properties (such as localStorage and sessionStorage) share data\n  // between windows in the same origin. This object is intended\n  // to contain such data.\n\n  if (options.commonForOrigin && options.commonForOrigin[documentOrigin]) {\n    this._commonForOrigin = options.commonForOrigin;\n  } else {\n    this._commonForOrigin = {\n      [documentOrigin]: {\n        localStorageArea: new Map(),\n        sessionStorageArea: new Map(),\n        windowsInSameOrigin: [this]\n      }\n    };\n  }\n\n  this._currentOriginData = this._commonForOrigin[documentOrigin]; // ### WEB STORAGE\n\n  this._localStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.localStorageArea,\n    type: \"localStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n  this._sessionStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.sessionStorageArea,\n    type: \"sessionStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  }); // ### SELECTION\n  // https://w3c.github.io/selection-api/#dfn-selection\n\n  this._selection = Selection.createImpl(window); // https://w3c.github.io/selection-api/#dom-window\n\n  this.getSelection = function () {\n    return window._selection;\n  }; // ### GETTERS\n\n\n  const locationbar = BarProp.create(window);\n  const menubar = BarProp.create(window);\n  const personalbar = BarProp.create(window);\n  const scrollbars = BarProp.create(window);\n  const statusbar = BarProp.create(window);\n  const toolbar = BarProp.create(window);\n  const external = External.create(window);\n  const navigator = Navigator.create(window, [], {\n    userAgent: this._resourceLoader._userAgent\n  });\n  const performance = Performance.create(window, [], {\n    rawPerformance\n  });\n  const screen = Screen.create(window);\n  const customElementRegistry = CustomElementRegistry.create(window);\n  define(this, {\n    get length() {\n      return window._length;\n    },\n\n    get window() {\n      return window._globalProxy;\n    },\n\n    get frameElement() {\n      return idlUtils.wrapperForImpl(window._frameElement);\n    },\n\n    get frames() {\n      return window._globalProxy;\n    },\n\n    get self() {\n      return window._globalProxy;\n    },\n\n    get parent() {\n      return window._parent;\n    },\n\n    get top() {\n      return window._top;\n    },\n\n    get document() {\n      return window._document;\n    },\n\n    get external() {\n      return external;\n    },\n\n    get location() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._location);\n    },\n\n    get history() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._history);\n    },\n\n    get navigator() {\n      return navigator;\n    },\n\n    get locationbar() {\n      return locationbar;\n    },\n\n    get menubar() {\n      return menubar;\n    },\n\n    get personalbar() {\n      return personalbar;\n    },\n\n    get scrollbars() {\n      return scrollbars;\n    },\n\n    get statusbar() {\n      return statusbar;\n    },\n\n    get toolbar() {\n      return toolbar;\n    },\n\n    get performance() {\n      return performance;\n    },\n\n    get screen() {\n      return screen;\n    },\n\n    get origin() {\n      return window._origin;\n    },\n\n    // The origin IDL attribute is defined with [Replaceable].\n    set origin(value) {\n      Object.defineProperty(this, \"origin\", {\n        value,\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n    },\n\n    get localStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\"localStorage is not available for opaque origins\", \"SecurityError\"]);\n      }\n\n      return this._localStorage;\n    },\n\n    get sessionStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\"sessionStorage is not available for opaque origins\", \"SecurityError\"]);\n      }\n\n      return this._sessionStorage;\n    },\n\n    get customElements() {\n      return customElementRegistry;\n    },\n\n    get event() {\n      return window._currentEvent ? idlUtils.wrapperForImpl(window._currentEvent) : undefined;\n    },\n\n    set event(value) {\n      Object.defineProperty(window, \"event\", {\n        configurable: true,\n        enumerable: true,\n        writable: true,\n        value\n      });\n    }\n\n  });\n  namedPropertiesWindow.initializeWindow(this, this._globalProxy); // ### METHODS\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers\n  // In the spec the list of active timers is a set of IDs. We make it a map of IDs to Node.js timer objects, so that\n  // we can call Node.js-side clearTimeout() when clearing, and thus allow process shutdown faster.\n\n  const listOfActiveTimers = new Map();\n  let latestTimerId = 0;\n\n  this.setTimeout = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n\n    timeout = webIDLConversions.long(timeout);\n    return timerInitializationSteps(handler, timeout, args, {\n      methodContext: window,\n      repeat: false\n    });\n  };\n\n  this.setInterval = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n\n    timeout = webIDLConversions.long(timeout);\n    return timerInitializationSteps(handler, timeout, args, {\n      methodContext: window,\n      repeat: true\n    });\n  };\n\n  this.clearTimeout = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n    const nodejsTimer = listOfActiveTimers.get(handle);\n\n    if (nodejsTimer) {\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n\n  this.clearInterval = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n    const nodejsTimer = listOfActiveTimers.get(handle);\n\n    if (nodejsTimer) {\n      // We use setTimeout() in timerInitializationSteps even for this.setInterval().\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n\n  function timerInitializationSteps(handler, timeout, args, {\n    methodContext,\n    repeat,\n    previousHandle\n  }) {\n    // This appears to be unspecced, but matches browser behavior for close()ed windows.\n    if (!methodContext._document) {\n      return 0;\n    } // TODO: implement timer nesting level behavior.\n\n\n    const methodContextProxy = methodContext._globalProxy;\n    const handle = previousHandle !== undefined ? previousHandle : ++latestTimerId;\n\n    function task() {\n      if (!listOfActiveTimers.has(handle)) {\n        return;\n      }\n\n      try {\n        if (typeof handler === \"function\") {\n          handler.apply(methodContextProxy, args);\n        } else if (window._runScripts === \"dangerously\") {\n          vm.runInContext(handler, window, {\n            filename: window.location.href,\n            displayErrors: false\n          });\n        }\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n\n      if (listOfActiveTimers.has(handle)) {\n        if (repeat) {\n          timerInitializationSteps(handler, timeout, args, {\n            methodContext,\n            repeat: true,\n            previousHandle: handle\n          });\n        } else {\n          listOfActiveTimers.delete(handle);\n        }\n      }\n    }\n\n    if (timeout < 0) {\n      timeout = 0;\n    }\n\n    const nodejsTimer = setTimeout(task, timeout);\n    listOfActiveTimers.set(handle, nodejsTimer);\n    return handle;\n  } // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#microtask-queuing\n\n\n  this.queueMicrotask = function (callback) {\n    callback = webIDLConversions.Function(callback);\n    anyNodeVersionQueueMicrotask(() => {\n      try {\n        callback();\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n    });\n  }; // https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#animation-frames\n\n\n  let animationFrameCallbackId = 0;\n  const mapOfAnimationFrameCallbacks = new Map();\n  let animationFrameNodejsInterval = null; // Unlike the spec, where an animation frame happens every 60 Hz regardless, we optimize so that if there are no\n  // requestAnimationFrame() calls outstanding, we don't fire the timer. This helps us track that.\n\n  let numberOfOngoingAnimationFrameCallbacks = 0;\n\n  if (this._pretendToBeVisual) {\n    this.requestAnimationFrame = function (callback) {\n      callback = webIDLConversions.Function(callback);\n      const handle = ++animationFrameCallbackId;\n      mapOfAnimationFrameCallbacks.set(handle, callback);\n      ++numberOfOngoingAnimationFrameCallbacks;\n\n      if (numberOfOngoingAnimationFrameCallbacks === 1) {\n        animationFrameNodejsInterval = setInterval(() => {\n          runAnimationFrameCallbacks(rawPerformance.now() - windowInitialized);\n        }, 1000 / 60);\n      }\n\n      return handle;\n    };\n\n    this.cancelAnimationFrame = function (handle) {\n      handle = webIDLConversions[\"unsigned long\"](handle);\n      removeAnimationFrameCallback(handle);\n    };\n\n    function runAnimationFrameCallbacks(now) {\n      // Converting to an array is important to get a sync snapshot and thus match spec semantics.\n      const callbackHandles = [...mapOfAnimationFrameCallbacks.keys()];\n\n      for (const handle of callbackHandles) {\n        // This has() can be false if a callback calls cancelAnimationFrame().\n        if (mapOfAnimationFrameCallbacks.has(handle)) {\n          const callback = mapOfAnimationFrameCallbacks.get(handle);\n          removeAnimationFrameCallback(handle);\n\n          try {\n            callback(now);\n          } catch (e) {\n            reportException(window, e, window.location.href);\n          }\n        }\n      }\n    }\n\n    function removeAnimationFrameCallback(handle) {\n      if (mapOfAnimationFrameCallbacks.has(handle)) {\n        --numberOfOngoingAnimationFrameCallbacks;\n\n        if (numberOfOngoingAnimationFrameCallbacks === 0) {\n          clearInterval(animationFrameNodejsInterval);\n        }\n      }\n\n      mapOfAnimationFrameCallbacks.delete(handle);\n    }\n  }\n\n  function stopAllTimers() {\n    for (const nodejsTimer of listOfActiveTimers.values()) {\n      clearTimeout(nodejsTimer);\n    }\n\n    listOfActiveTimers.clear();\n    clearInterval(animationFrameNodejsInterval);\n  }\n\n  function Option(text, value, defaultSelected, selected) {\n    if (text === undefined) {\n      text = \"\";\n    }\n\n    text = webIDLConversions.DOMString(text);\n\n    if (value !== undefined) {\n      value = webIDLConversions.DOMString(value);\n    }\n\n    defaultSelected = webIDLConversions.boolean(defaultSelected);\n    selected = webIDLConversions.boolean(selected);\n\n    const option = window._document.createElement(\"option\");\n\n    const impl = idlUtils.implForWrapper(option);\n\n    if (text !== \"\") {\n      impl.text = text;\n    }\n\n    if (value !== undefined) {\n      impl.setAttributeNS(null, \"value\", value);\n    }\n\n    if (defaultSelected) {\n      impl.setAttributeNS(null, \"selected\", \"\");\n    }\n\n    impl._selectedness = selected;\n    return option;\n  }\n\n  Object.defineProperty(Option, \"prototype\", {\n    value: this.HTMLOptionElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Option\", {\n    value: Option,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Image(...args) {\n    const img = window._document.createElement(\"img\");\n\n    const impl = idlUtils.implForWrapper(img);\n\n    if (args.length > 0) {\n      impl.setAttributeNS(null, \"width\", String(args[0]));\n    }\n\n    if (args.length > 1) {\n      impl.setAttributeNS(null, \"height\", String(args[1]));\n    }\n\n    return img;\n  }\n\n  Object.defineProperty(Image, \"prototype\", {\n    value: this.HTMLImageElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Image\", {\n    value: Image,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Audio(src) {\n    const audio = window._document.createElement(\"audio\");\n\n    const impl = idlUtils.implForWrapper(audio);\n    impl.setAttributeNS(null, \"preload\", \"auto\");\n\n    if (src !== undefined) {\n      impl.setAttributeNS(null, \"src\", String(src));\n    }\n\n    return audio;\n  }\n\n  Object.defineProperty(Audio, \"prototype\", {\n    value: this.HTMLAudioElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Audio\", {\n    value: Audio,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n  this.postMessage = postMessage(window);\n\n  this.atob = function (str) {\n    const result = atob(str);\n\n    if (result === null) {\n      throw DOMException.create(window, [\"The string to be decoded contains invalid characters.\", \"InvalidCharacterError\"]);\n    }\n\n    return result;\n  };\n\n  this.btoa = function (str) {\n    const result = btoa(str);\n\n    if (result === null) {\n      throw DOMException.create(window, [\"The string to be encoded contains invalid characters.\", \"InvalidCharacterError\"]);\n    }\n\n    return result;\n  };\n\n  this.stop = function () {\n    const manager = idlUtils.implForWrapper(this._document)._requestManager;\n\n    if (manager) {\n      manager.close();\n    }\n  };\n\n  this.close = function () {\n    // Recursively close child frame windows, then ourselves (depth-first).\n    for (let i = 0; i < this.length; ++i) {\n      this[i].close();\n    } // Clear out all listeners. Any in-flight or upcoming events should not get delivered.\n\n\n    idlUtils.implForWrapper(this)._eventListeners = Object.create(null);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // It's especially important to clear out the listeners here because document.close() causes a \"load\" event to\n        // fire.\n        idlUtils.implForWrapper(this._document)._eventListeners = Object.create(null);\n\n        this._document.close();\n      }\n\n      const doc = idlUtils.implForWrapper(this._document);\n\n      if (doc._requestManager) {\n        doc._requestManager.close();\n      }\n\n      delete this._document;\n    }\n\n    stopAllTimers();\n    WebSocketImpl.cleanUpWindow(this);\n  };\n\n  this.getComputedStyle = function (elt, pseudoElt = undefined) {\n    elt = Element.convert(elt);\n\n    if (pseudoElt !== undefined && pseudoElt !== null) {\n      pseudoElt = webIDLConversions.DOMString(pseudoElt);\n    }\n\n    if (pseudoElt !== undefined && pseudoElt !== null && pseudoElt !== \"\") {\n      // TODO: Parse pseudoElt\n      if (SHADOW_DOM_PSEUDO_REGEXP.test(pseudoElt)) {\n        throw new TypeError(\"Tried to get the computed style of a Shadow DOM pseudo-element.\");\n      }\n\n      notImplemented(\"window.computedStyle(elt, pseudoElt)\", this);\n    }\n\n    const declaration = new CSSStyleDeclaration();\n    const {\n      forEach\n    } = Array.prototype;\n    const {\n      style\n    } = elt;\n    forEachMatchingSheetRuleOfElement(elt, rule => {\n      forEach.call(rule.style, property => {\n        declaration.setProperty(property, rule.style.getPropertyValue(property), rule.style.getPropertyPriority(property));\n      });\n    }); // https://drafts.csswg.org/cssom/#dom-window-getcomputedstyle\n\n    const declarations = Object.keys(propertiesWithResolvedValueImplemented);\n    forEach.call(declarations, property => {\n      declaration.setProperty(property, getResolvedValue(elt, property));\n    });\n    forEach.call(style, property => {\n      declaration.setProperty(property, style.getPropertyValue(property), style.getPropertyPriority(property));\n    });\n    return declaration;\n  };\n\n  this.getSelection = function () {\n    return window._document.getSelection();\n  }; // The captureEvents() and releaseEvents() methods must do nothing\n\n\n  this.captureEvents = function () {};\n\n  this.releaseEvents = function () {}; // ### PUBLIC DATA PROPERTIES (TODO: should be getters)\n\n\n  function wrapConsoleMethod(method) {\n    return (...args) => {\n      window._virtualConsole.emit(method, ...args);\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    countReset: wrapConsoleMethod(\"countReset\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    dir: wrapConsoleMethod(\"dir\"),\n    dirxml: wrapConsoleMethod(\"dirxml\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapsed: wrapConsoleMethod(\"groupCollapsed\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeLog: wrapConsoleMethod(\"timeLog\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  function notImplementedMethod(name) {\n    return function () {\n      notImplemented(name, window);\n    };\n  }\n\n  define(this, {\n    name: \"\",\n    status: \"\",\n    devicePixelRatio: 1,\n    innerWidth: 1024,\n    innerHeight: 768,\n    outerWidth: 1024,\n    outerHeight: 768,\n    pageXOffset: 0,\n    pageYOffset: 0,\n    screenX: 0,\n    screenLeft: 0,\n    screenY: 0,\n    screenTop: 0,\n    scrollX: 0,\n    scrollY: 0,\n    alert: notImplementedMethod(\"window.alert\"),\n    blur: notImplementedMethod(\"window.blur\"),\n    confirm: notImplementedMethod(\"window.confirm\"),\n    focus: notImplementedMethod(\"window.focus\"),\n    moveBy: notImplementedMethod(\"window.moveBy\"),\n    moveTo: notImplementedMethod(\"window.moveTo\"),\n    open: notImplementedMethod(\"window.open\"),\n    print: notImplementedMethod(\"window.print\"),\n    prompt: notImplementedMethod(\"window.prompt\"),\n    resizeBy: notImplementedMethod(\"window.resizeBy\"),\n    resizeTo: notImplementedMethod(\"window.resizeTo\"),\n    scroll: notImplementedMethod(\"window.scroll\"),\n    scrollBy: notImplementedMethod(\"window.scrollBy\"),\n    scrollTo: notImplementedMethod(\"window.scrollTo\")\n  }); // ### INITIALIZATION\n\n  process.nextTick(() => {\n    if (!window.document) {\n      return; // window might've been closed already\n    }\n\n    const documentImpl = idlUtils.implForWrapper(window._document);\n\n    if (window.document.readyState === \"complete\") {\n      fireAnEvent(\"load\", window, undefined, {}, documentImpl);\n    } else {\n      window.document.addEventListener(\"load\", () => {\n        fireAnEvent(\"load\", window, undefined, {}, documentImpl);\n\n        if (!documentImpl._pageShowingFlag) {\n          documentImpl._pageShowingFlag = true;\n          fireAnEvent(\"pageshow\", window, PageTransitionEvent, {\n            persisted: false\n          }, documentImpl);\n        }\n      });\n    }\n  });\n}\n\nfunction contextifyWindow(window) {\n  if (vm.isContext(window)) {\n    return;\n  }\n\n  vm.createContext(window);\n}","map":{"version":3,"sources":["/Users/kanavmittal/Downloads/Anonymous-Doubt-Session-Application-Ashank-App/node_modules/jsdom/lib/jsdom/browser/Window.js"],"names":["vm","require","webIDLConversions","CSSStyleDeclaration","Performance","RawPerformance","notImplemented","installInterfaces","define","mixin","Element","EventTarget","EventHandlerNonNull","OnBeforeUnloadEventHandlerNonNull","OnErrorEventHandlerNonNull","PageTransitionEvent","namedPropertiesWindow","postMessage","DOMException","btoa","atob","idlUtils","WebSocketImpl","implementation","BarProp","documents","External","Navigator","Screen","Storage","Selection","reportException","getCurrentEventHandlerValue","fireAnEvent","SessionHistory","forEachMatchingSheetRuleOfElement","getResolvedValue","propertiesWithResolvedValueImplemented","SHADOW_DOM_PSEUDO_REGEXP","CustomElementRegistry","jsGlobals","GlobalEventHandlersImpl","WindowEventHandlersImpl","events","Set","exports","createWindow","options","Window","jsGlobalEntriesToInstall","Object","entries","filter","name","global","anyNodeVersionQueueMicrotask","queueMicrotask","process","nextTick","setupWindow","windowInstance","runScripts","contextifyWindow","globalName","globalPropDesc","propDesc","value","runInContext","defineProperty","EventTargetConstructor","windowConstructor","TypeError","setPrototypeOf","configurable","writable","windowPrototype","create","prototype","defineProperties","constructor","Symbol","toStringTag","setup","_initGlobalEvents","enumerable","get","tryWrapperForImpl","set","V","isObject","convert","context","_setEventHandlerFor","event","_globalObject","rawPerformance","windowInitialized","now","window","_resourceLoader","resourceLoader","_globalProxy","implForWrapper","wrapperSymbol","_document","createWrapper","parsingMode","contentType","encoding","cookieJar","url","lastModified","referrer","concurrentNodeIterators","parseOptions","defaultView","parentOrigin","alwaysUseDocumentClass","isContext","documentImpl","_defaultView","documentOrigin","_origin","_sessionHistory","document","_URL","stateObject","_virtualConsole","virtualConsole","_runScripts","_parent","_top","_frameElement","_length","_currentEvent","undefined","_pretendToBeVisual","pretendToBeVisual","_storageQuota","storageQuota","commonForOrigin","_commonForOrigin","localStorageArea","Map","sessionStorageArea","windowsInSameOrigin","_currentOriginData","_localStorage","associatedWindow","storageArea","type","documentURI","_sessionStorage","_selection","createImpl","getSelection","locationbar","menubar","personalbar","scrollbars","statusbar","toolbar","external","navigator","userAgent","_userAgent","performance","screen","customElementRegistry","length","frameElement","wrapperForImpl","frames","self","parent","top","location","_location","history","_history","origin","localStorage","sessionStorage","customElements","initializeWindow","listOfActiveTimers","latestTimerId","setTimeout","handler","timeout","args","DOMString","long","timerInitializationSteps","methodContext","repeat","setInterval","clearTimeout","handle","nodejsTimer","delete","clearInterval","previousHandle","methodContextProxy","task","has","apply","filename","href","displayErrors","e","callback","Function","animationFrameCallbackId","mapOfAnimationFrameCallbacks","animationFrameNodejsInterval","numberOfOngoingAnimationFrameCallbacks","requestAnimationFrame","runAnimationFrameCallbacks","cancelAnimationFrame","removeAnimationFrameCallback","callbackHandles","keys","stopAllTimers","values","clear","Option","text","defaultSelected","selected","boolean","option","createElement","impl","setAttributeNS","_selectedness","HTMLOptionElement","Image","img","String","HTMLImageElement","Audio","src","audio","HTMLAudioElement","str","result","stop","manager","_requestManager","close","i","_eventListeners","body","innerHTML","doc","cleanUpWindow","getComputedStyle","elt","pseudoElt","test","declaration","forEach","Array","style","rule","call","property","setProperty","getPropertyValue","getPropertyPriority","declarations","captureEvents","releaseEvents","wrapConsoleMethod","method","emit","console","assert","count","countReset","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","table","time","timeLog","timeEnd","trace","warn","notImplementedMethod","status","devicePixelRatio","innerWidth","innerHeight","outerWidth","outerHeight","pageXOffset","pageYOffset","screenX","screenLeft","screenY","screenTop","scrollX","scrollY","alert","blur","confirm","focus","moveBy","moveTo","open","print","prompt","resizeBy","resizeTo","scroll","scrollBy","scrollTo","readyState","addEventListener","_pageShowingFlag","persisted","createContext"],"mappings":"AAAA;;AACA,MAAMA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;AACA,MAAMC,iBAAiB,GAAGD,OAAO,CAAC,oBAAD,CAAjC;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAA0BF,OAAO,CAAC,UAAD,CAAvC;;AACA,MAAM;AAAEG,EAAAA,WAAW,EAAEC;AAAf,IAAkCJ,OAAO,CAAC,aAAD,CAA/C;;AACA,MAAMK,cAAc,GAAGL,OAAO,CAAC,mBAAD,CAA9B;;AACA,MAAM;AAAEM,EAAAA;AAAF,IAAwBN,OAAO,CAAC,sBAAD,CAArC;;AACA,MAAM;AAAEO,EAAAA,MAAF;AAAUC,EAAAA;AAAV,IAAoBR,OAAO,CAAC,UAAD,CAAjC;;AACA,MAAMS,OAAO,GAAGT,OAAO,CAAC,6BAAD,CAAvB;;AACA,MAAMU,WAAW,GAAGV,OAAO,CAAC,iCAAD,CAA3B;;AACA,MAAMW,mBAAmB,GAAGX,OAAO,CAAC,yCAAD,CAAnC;;AACA,MAAMY,iCAAiC,GAAGZ,OAAO,CAAC,uDAAD,CAAjD;;AACA,MAAMa,0BAA0B,GAAGb,OAAO,CAAC,gDAAD,CAA1C;;AACA,MAAMc,mBAAmB,GAAGd,OAAO,CAAC,yCAAD,CAAnC;;AACA,MAAMe,qBAAqB,GAAGf,OAAO,CAAC,mCAAD,CAArC;;AACA,MAAMgB,WAAW,GAAGhB,OAAO,CAAC,wBAAD,CAA3B;;AACA,MAAMiB,YAAY,GAAGjB,OAAO,CAAC,gCAAD,CAA5B;;AACA,MAAM;AAAEkB,EAAAA,IAAF;AAAQC,EAAAA;AAAR,IAAiBnB,OAAO,CAAC,MAAD,CAA9B;;AACA,MAAMoB,QAAQ,GAAGpB,OAAO,CAAC,2BAAD,CAAxB;;AACA,MAAMqB,aAAa,GAAGrB,OAAO,CAAC,qCAAD,CAAP,CAA+CsB,cAArE;;AACA,MAAMC,OAAO,GAAGvB,OAAO,CAAC,6BAAD,CAAvB;;AACA,MAAMwB,SAAS,GAAGxB,OAAO,CAAC,wBAAD,CAAzB;;AACA,MAAMyB,QAAQ,GAAGzB,OAAO,CAAC,8BAAD,CAAxB;;AACA,MAAM0B,SAAS,GAAG1B,OAAO,CAAC,+BAAD,CAAzB;;AACA,MAAMG,WAAW,GAAGH,OAAO,CAAC,iCAAD,CAA3B;;AACA,MAAM2B,MAAM,GAAG3B,OAAO,CAAC,4BAAD,CAAtB;;AACA,MAAM4B,OAAO,GAAG5B,OAAO,CAAC,6BAAD,CAAvB;;AACA,MAAM6B,SAAS,GAAG7B,OAAO,CAAC,+BAAD,CAAzB;;AACA,MAAM8B,eAAe,GAAG9B,OAAO,CAAC,yCAAD,CAA/B;;AACA,MAAM;AAAE+B,EAAAA;AAAF,IAAkC/B,OAAO,CAAC,4CAAD,CAA/C;;AACA,MAAM;AAAEgC,EAAAA;AAAF,IAAkBhC,OAAO,CAAC,0BAAD,CAA/B;;AACA,MAAMiC,cAAc,GAAGjC,OAAO,CAAC,iCAAD,CAA9B;;AACA,MAAM;AAAEkC,EAAAA,iCAAF;AAAqCC,EAAAA,gBAArC;AAAuDC,EAAAA,sCAAvD;AACJC,EAAAA;AADI,IACyBrC,OAAO,CAAC,kCAAD,CADtC;;AAEA,MAAMsC,qBAAqB,GAAGtC,OAAO,CAAC,2CAAD,CAArC;;AACA,MAAMuC,SAAS,GAAGvC,OAAO,CAAC,mBAAD,CAAzB;;AAEA,MAAMwC,uBAAuB,GAAGxC,OAAO,CAAC,0CAAD,CAAP,CAAoDsB,cAApF;;AACA,MAAMmB,uBAAuB,GAAGzC,OAAO,CAAC,0CAAD,CAAP,CAAoDsB,cAApF;;AAEA,MAAMoB,MAAM,GAAG,IAAIC,GAAJ,CAAQ,CACrB;AACA,OAFqB,EAEZ,cAFY,EAGrB,mBAHqB,EAGA,MAHA,EAIrB,QAJqB,EAIX,SAJW,EAIA,gBAJA,EAKrB,QALqB,EAKX,OALW,EAMrB,OANqB,EAMZ,aANY,EAOrB,WAPqB,EAOR,UAPQ,EAQrB,MARqB,EAQb,SARa,EASrB,WATqB,EAUrB,WAVqB,EAUR,UAVQ,EAWrB,WAXqB,EAWR,MAXQ,EAYrB,gBAZqB,EAYH,SAZG,EAarB,OAbqB,EAaZ,OAbY,EAcrB,OAdqB,EAcZ,SAdY,EAerB,SAfqB,EAeV,UAfU,EAgBrB,OAhBqB,EAgBZ,MAhBY,EAgBJ,YAhBI,EAiBrB,gBAjBqB,EAiBH,WAjBG,EAkBrB,WAlBqB,EAkBR,YAlBQ,EAmBrB,YAnBqB,EAmBP,WAnBO,EAoBrB,UApBqB,EAoBT,WApBS,EAqBrB,SArBqB,EAqBV,OArBU,EAsBrB,OAtBqB,EAsBZ,MAtBY,EAuBrB,SAvBqB,EAuBV,UAvBU,EAwBrB,YAxBqB,EAwBP,OAxBO,EAyBrB,QAzBqB,EAyBX,QAzBW,EA0BrB,yBA1BqB,EA2BrB,QA3BqB,EA2BX,SA3BW,EA4BrB,QA5BqB,EA4BX,MA5BW,EA4BH,SA5BG,EA6BrB,QA7BqB,EA6BX,SA7BW,EA8BrB,YA9BqB,EA8BP,QA9BO,EA+BrB,cA/BqB,EA+BL,SA/BK,EAiCrB;AACA,YAlCqB,EAmCrB,aAnCqB,EAoCrB,YApCqB,EAqCrB,gBArCqB,EAsCrB,SAtCqB,EAuCrB,cAvCqB,EAwCrB,SAxCqB,EAyCrB,QAzCqB,EA0CrB,UA1CqB,EA2CrB,UA3CqB,EA4CrB,UA5CqB,EA6CrB,kBA7CqB,EA8CrB,SA9CqB,EA+CrB,oBA/CqB,EAgDrB,QAhDqB,CAkDrB;AAlDqB,CAAR,CAAf;;AAqDAC,OAAO,CAACC,YAAR,GAAuB,UAAUC,OAAV,EAAmB;AACxC,SAAO,IAAIC,MAAJ,CAAWD,OAAX,CAAP;AACD,CAFD;;AAIA,MAAME,wBAAwB,GAAGC,MAAM,CAACC,OAAP,CAAeX,SAAf,EAA0BY,MAA1B,CAAiC,CAAC,CAACC,IAAD,CAAD,KAAYA,IAAI,IAAIC,MAArD,CAAjC,C,CAEA;;AACA,MAAMC,4BAA4B,GAAG,OAAOC,cAAP,KAA0B,UAA1B,GAAuCA,cAAvC,GAAwDC,OAAO,CAACC,QAArG,C,CAEA;;AACA,SAASC,WAAT,CAAqBC,cAArB,EAAqC;AAAEC,EAAAA;AAAF,CAArC,EAAqD;AACnD,MAAIA,UAAU,KAAK,cAAf,IAAiCA,UAAU,KAAK,aAApD,EAAmE;AACjEC,IAAAA,gBAAgB,CAACF,cAAD,CAAhB,CADiE,CAGjE;AACA;;AACA,SAAK,MAAM,CAACG,UAAD,EAAaC,cAAb,CAAX,IAA2Cf,wBAA3C,EAAqE;AACnE,YAAMgB,QAAQ,GAAG,EAAE,GAAGD,cAAL;AAAqBE,QAAAA,KAAK,EAAElE,EAAE,CAACmE,YAAH,CAAgBJ,UAAhB,EAA4BH,cAA5B;AAA5B,OAAjB;AACAV,MAAAA,MAAM,CAACkB,cAAP,CAAsBR,cAAtB,EAAsCG,UAAtC,EAAkDE,QAAlD;AACD;AACF,GATD,MASO;AACL;AACA;AACA,SAAK,MAAM,CAACF,UAAD,EAAaC,cAAb,CAAX,IAA2Cf,wBAA3C,EAAqE;AACnE,YAAMgB,QAAQ,GAAG,EAAE,GAAGD,cAAL;AAAqBE,QAAAA,KAAK,EAAEZ,MAAM,CAACS,UAAD;AAAlC,OAAjB;AACAb,MAAAA,MAAM,CAACkB,cAAP,CAAsBR,cAAtB,EAAsCG,UAAtC,EAAkDE,QAAlD;AACD;AACF;;AAED1D,EAAAA,iBAAiB,CAACqD,cAAD,EAAiB,CAAC,QAAD,CAAjB,CAAjB;AAEA,QAAMS,sBAAsB,GAAGT,cAAc,CAACjD,WAA9C,CArBmD,CAuBnD;;AACA,QAAM2D,iBAAiB,GAAG,SAAStB,MAAT,GAAkB;AAC1C,UAAM,IAAIuB,SAAJ,CAAc,qBAAd,CAAN;AACD,GAFD;;AAGArB,EAAAA,MAAM,CAACsB,cAAP,CAAsBF,iBAAtB,EAAyCD,sBAAzC;AAEAnB,EAAAA,MAAM,CAACkB,cAAP,CAAsBR,cAAtB,EAAsC,QAAtC,EAAgD;AAC9Ca,IAAAA,YAAY,EAAE,IADgC;AAE9CC,IAAAA,QAAQ,EAAE,IAFoC;AAG9CR,IAAAA,KAAK,EAAEI;AAHuC,GAAhD;AAMA,QAAMK,eAAe,GAAGzB,MAAM,CAAC0B,MAAP,CAAcP,sBAAsB,CAACQ,SAArC,CAAxB;AACA3B,EAAAA,MAAM,CAAC4B,gBAAP,CAAwBH,eAAxB,EAAyC;AACvCI,IAAAA,WAAW,EAAE;AACXb,MAAAA,KAAK,EAAEI,iBADI;AAEXI,MAAAA,QAAQ,EAAE,IAFC;AAGXD,MAAAA,YAAY,EAAE;AAHH,KAD0B;AAMvC,KAACO,MAAM,CAACC,WAAR,GAAsB;AACpBf,MAAAA,KAAK,EAAE,QADa;AAEpBO,MAAAA,YAAY,EAAE;AAFM;AANiB,GAAzC;AAYAH,EAAAA,iBAAiB,CAACO,SAAlB,GAA8BF,eAA9B;AACAzB,EAAAA,MAAM,CAACsB,cAAP,CAAsBZ,cAAtB,EAAsCe,eAAtC;AAEAhE,EAAAA,WAAW,CAACuE,KAAZ,CAAkBtB,cAAlB,EAAkCA,cAAlC;AACAnD,EAAAA,KAAK,CAACmD,cAAD,EAAiBlB,uBAAuB,CAACmC,SAAzC,CAAL;AACApE,EAAAA,KAAK,CAACmD,cAAD,EAAiBnB,uBAAuB,CAACoC,SAAzC,CAAL;;AACAjB,EAAAA,cAAc,CAACuB,iBAAf;;AAEAjC,EAAAA,MAAM,CAACkB,cAAP,CAAsBR,cAAtB,EAAsC,gBAAtC,EAAwD;AACtDa,IAAAA,YAAY,EAAE,IADwC;AAEtDW,IAAAA,UAAU,EAAE,IAF0C;;AAGtDC,IAAAA,GAAG,GAAG;AACJ,aAAOhE,QAAQ,CAACiE,iBAAT,CAA2BtD,2BAA2B,CAAC,IAAD,EAAO,cAAP,CAAtD,CAAP;AACD,KALqD;;AAMtDuD,IAAAA,GAAG,CAACC,CAAD,EAAI;AACL,UAAI,CAACnE,QAAQ,CAACoE,QAAT,CAAkBD,CAAlB,CAAL,EAA2B;AACzBA,QAAAA,CAAC,GAAG,IAAJ;AACD,OAFD,MAEO;AACLA,QAAAA,CAAC,GAAG3E,iCAAiC,CAAC6E,OAAlC,CAA0CF,CAA1C,EAA6C;AAC/CG,UAAAA,OAAO,EAAE;AADsC,SAA7C,CAAJ;AAGD;;AACD,WAAKC,mBAAL,CAAyB,cAAzB,EAAyCJ,CAAzC;AACD;;AAfqD,GAAxD;AAkBAtC,EAAAA,MAAM,CAACkB,cAAP,CAAsBR,cAAtB,EAAsC,SAAtC,EAAiD;AAC/Ca,IAAAA,YAAY,EAAE,IADiC;AAE/CW,IAAAA,UAAU,EAAE,IAFmC;;AAG/CC,IAAAA,GAAG,GAAG;AACJ,aAAOhE,QAAQ,CAACiE,iBAAT,CAA2BtD,2BAA2B,CAAC,IAAD,EAAO,OAAP,CAAtD,CAAP;AACD,KAL8C;;AAM/CuD,IAAAA,GAAG,CAACC,CAAD,EAAI;AACL,UAAI,CAACnE,QAAQ,CAACoE,QAAT,CAAkBD,CAAlB,CAAL,EAA2B;AACzBA,QAAAA,CAAC,GAAG,IAAJ;AACD,OAFD,MAEO;AACLA,QAAAA,CAAC,GAAG1E,0BAA0B,CAAC4E,OAA3B,CAAmCF,CAAnC,EAAsC;AACxCG,UAAAA,OAAO,EAAE;AAD+B,SAAtC,CAAJ;AAGD;;AACD,WAAKC,mBAAL,CAAyB,OAAzB,EAAkCJ,CAAlC;AACD;;AAf8C,GAAjD;;AAkBA,OAAK,MAAMK,KAAX,IAAoBlD,MAApB,EAA4B;AAC1BO,IAAAA,MAAM,CAACkB,cAAP,CAAsBR,cAAtB,EAAuC,KAAIiC,KAAM,EAAjD,EAAoD;AAClDpB,MAAAA,YAAY,EAAE,IADoC;AAElDW,MAAAA,UAAU,EAAE,IAFsC;;AAGlDC,MAAAA,GAAG,GAAG;AACJ,eAAOhE,QAAQ,CAACiE,iBAAT,CAA2BtD,2BAA2B,CAAC,IAAD,EAAO6D,KAAP,CAAtD,CAAP;AACD,OALiD;;AAMlDN,MAAAA,GAAG,CAACC,CAAD,EAAI;AACL,YAAI,CAACnE,QAAQ,CAACoE,QAAT,CAAkBD,CAAlB,CAAL,EAA2B;AACzBA,UAAAA,CAAC,GAAG,IAAJ;AACD,SAFD,MAEO;AACLA,UAAAA,CAAC,GAAG5E,mBAAmB,CAAC8E,OAApB,CAA4BF,CAA5B,EAA+B;AACjCG,YAAAA,OAAO,EAAG,wBAAuBE,KAAM;AADN,WAA/B,CAAJ;AAGD;;AACD,aAAKD,mBAAL,CAAyBC,KAAzB,EAAgCL,CAAhC;AACD;;AAfiD,KAApD;AAiBD;;AAED5B,EAAAA,cAAc,CAACkC,aAAf,GAA+BlC,cAA/B;AACD,C,CAED;AACA;AACA;;;AACA,SAASZ,MAAT,CAAgBD,OAAhB,EAAyB;AACvBY,EAAAA,WAAW,CAAC,IAAD,EAAO;AAAEE,IAAAA,UAAU,EAAEd,OAAO,CAACc;AAAtB,GAAP,CAAX;AAEA,QAAMkC,cAAc,GAAG,IAAI1F,cAAJ,EAAvB;AACA,QAAM2F,iBAAiB,GAAGD,cAAc,CAACE,GAAf,EAA1B;AAEA,QAAMC,MAAM,GAAG,IAAf,CANuB,CAQvB;;AAEA,OAAKC,eAAL,GAAuBpD,OAAO,CAACqD,cAA/B,CAVuB,CAYvB;;AACA,OAAKC,YAAL,GAAoB,IAApB;AACAnD,EAAAA,MAAM,CAACkB,cAAP,CAAsB/C,QAAQ,CAACiF,cAAT,CAAwB,IAAxB,CAAtB,EAAqDjF,QAAQ,CAACkF,aAA9D,EAA6E;AAAElB,IAAAA,GAAG,EAAE,MAAM,KAAKgB;AAAlB,GAA7E,EAduB,CAgBvB;;AACA,OAAKG,SAAL,GAAiB/E,SAAS,CAACgF,aAAV,CAAwBP,MAAxB,EAAgC;AAC/CQ,IAAAA,WAAW,EAAE3D,OAAO,CAAC2D,WAD0B;AAE/CC,IAAAA,WAAW,EAAE5D,OAAO,CAAC4D,WAF0B;AAG/CC,IAAAA,QAAQ,EAAE7D,OAAO,CAAC6D,QAH6B;AAI/CC,IAAAA,SAAS,EAAE9D,OAAO,CAAC8D,SAJ4B;AAK/CC,IAAAA,GAAG,EAAE/D,OAAO,CAAC+D,GALkC;AAM/CC,IAAAA,YAAY,EAAEhE,OAAO,CAACgE,YANyB;AAO/CC,IAAAA,QAAQ,EAAEjE,OAAO,CAACiE,QAP6B;AAQ/CC,IAAAA,uBAAuB,EAAElE,OAAO,CAACkE,uBARc;AAS/CC,IAAAA,YAAY,EAAEnE,OAAO,CAACmE,YATyB;AAU/CC,IAAAA,WAAW,EAAE,KAAKd,YAV6B;AAW/C/C,IAAAA,MAAM,EAAE,IAXuC;AAY/C8D,IAAAA,YAAY,EAAErE,OAAO,CAACqE;AAZyB,GAAhC,EAad;AAAEC,IAAAA,sBAAsB,EAAE;AAA1B,GAbc,CAAjB;;AAeA,MAAIrH,EAAE,CAACsH,SAAH,CAAapB,MAAb,CAAJ,EAA0B;AACxB,UAAMqB,YAAY,GAAGlG,QAAQ,CAACiF,cAAT,CAAwBJ,MAAM,CAACM,SAA/B,CAArB;AACAe,IAAAA,YAAY,CAACC,YAAb,GAA4BtB,MAAM,CAACG,YAAP,GAAsBrG,EAAE,CAACmE,YAAH,CAAgB,MAAhB,EAAwB+B,MAAxB,CAAlD;AACD;;AAED,QAAMuB,cAAc,GAAGpG,QAAQ,CAACiF,cAAT,CAAwB,KAAKE,SAA7B,EAAwCkB,OAA/D;;AACA,OAAKA,OAAL,GAAeD,cAAf,CAtCuB,CAwCvB;;AACA,OAAKE,eAAL,GAAuB,IAAIzF,cAAJ,CAAmB;AACxC0F,IAAAA,QAAQ,EAAEvG,QAAQ,CAACiF,cAAT,CAAwB,KAAKE,SAA7B,CAD8B;AAExCM,IAAAA,GAAG,EAAEzF,QAAQ,CAACiF,cAAT,CAAwB,KAAKE,SAA7B,EAAwCqB,IAFL;AAGxCC,IAAAA,WAAW,EAAE;AAH2B,GAAnB,EAIpB,IAJoB,CAAvB;AAMA,OAAKC,eAAL,GAAuBhF,OAAO,CAACiF,cAA/B;AAEA,OAAKC,WAAL,GAAmBlF,OAAO,CAACc,UAA3B,CAjDuB,CAmDvB;AACA;;AACA,OAAKqE,OAAL,GAAe,KAAKC,IAAL,GAAY,KAAK9B,YAAhC;AACA,OAAK+B,aAAL,GAAqB,IAArB,CAtDuB,CAwDvB;AACA;AACA;;AACA,OAAKC,OAAL,GAAe,CAAf,CA3DuB,CA6DvB;;AACA,OAAKC,aAAL,GAAqBC,SAArB;AAEA,OAAKC,kBAAL,GAA0BzF,OAAO,CAAC0F,iBAAlC;AACA,OAAKC,aAAL,GAAqB3F,OAAO,CAAC4F,YAA7B,CAjEuB,CAmEvB;AACA;AACA;;AACA,MAAI5F,OAAO,CAAC6F,eAAR,IAA2B7F,OAAO,CAAC6F,eAAR,CAAwBnB,cAAxB,CAA/B,EAAwE;AACtE,SAAKoB,gBAAL,GAAwB9F,OAAO,CAAC6F,eAAhC;AACD,GAFD,MAEO;AACL,SAAKC,gBAAL,GAAwB;AACtB,OAACpB,cAAD,GAAkB;AAChBqB,QAAAA,gBAAgB,EAAE,IAAIC,GAAJ,EADF;AAEhBC,QAAAA,kBAAkB,EAAE,IAAID,GAAJ,EAFJ;AAGhBE,QAAAA,mBAAmB,EAAE,CAAC,IAAD;AAHL;AADI,KAAxB;AAOD;;AAED,OAAKC,kBAAL,GAA0B,KAAKL,gBAAL,CAAsBpB,cAAtB,CAA1B,CAlFuB,CAoFvB;;AAEA,OAAK0B,aAAL,GAAqBtH,OAAO,CAAC+C,MAAR,CAAesB,MAAf,EAAuB,EAAvB,EAA2B;AAC9CkD,IAAAA,gBAAgB,EAAE,IAD4B;AAE9CC,IAAAA,WAAW,EAAE,KAAKH,kBAAL,CAAwBJ,gBAFS;AAG9CQ,IAAAA,IAAI,EAAE,cAHwC;AAI9CxC,IAAAA,GAAG,EAAE,KAAKN,SAAL,CAAe+C,WAJ0B;AAK9CZ,IAAAA,YAAY,EAAE,KAAKD;AAL2B,GAA3B,CAArB;AAOA,OAAKc,eAAL,GAAuB3H,OAAO,CAAC+C,MAAR,CAAesB,MAAf,EAAuB,EAAvB,EAA2B;AAChDkD,IAAAA,gBAAgB,EAAE,IAD8B;AAEhDC,IAAAA,WAAW,EAAE,KAAKH,kBAAL,CAAwBF,kBAFW;AAGhDM,IAAAA,IAAI,EAAE,gBAH0C;AAIhDxC,IAAAA,GAAG,EAAE,KAAKN,SAAL,CAAe+C,WAJ4B;AAKhDZ,IAAAA,YAAY,EAAE,KAAKD;AAL6B,GAA3B,CAAvB,CA7FuB,CAqGvB;AAEA;;AACA,OAAKe,UAAL,GAAkB3H,SAAS,CAAC4H,UAAV,CAAqBxD,MAArB,CAAlB,CAxGuB,CA0GvB;;AACA,OAAKyD,YAAL,GAAoB,YAAY;AAC9B,WAAOzD,MAAM,CAACuD,UAAd;AACD,GAFD,CA3GuB,CA+GvB;;;AAEA,QAAMG,WAAW,GAAGpI,OAAO,CAACoD,MAAR,CAAesB,MAAf,CAApB;AACA,QAAM2D,OAAO,GAAGrI,OAAO,CAACoD,MAAR,CAAesB,MAAf,CAAhB;AACA,QAAM4D,WAAW,GAAGtI,OAAO,CAACoD,MAAR,CAAesB,MAAf,CAApB;AACA,QAAM6D,UAAU,GAAGvI,OAAO,CAACoD,MAAR,CAAesB,MAAf,CAAnB;AACA,QAAM8D,SAAS,GAAGxI,OAAO,CAACoD,MAAR,CAAesB,MAAf,CAAlB;AACA,QAAM+D,OAAO,GAAGzI,OAAO,CAACoD,MAAR,CAAesB,MAAf,CAAhB;AACA,QAAMgE,QAAQ,GAAGxI,QAAQ,CAACkD,MAAT,CAAgBsB,MAAhB,CAAjB;AACA,QAAMiE,SAAS,GAAGxI,SAAS,CAACiD,MAAV,CAAiBsB,MAAjB,EAAyB,EAAzB,EAA6B;AAAEkE,IAAAA,SAAS,EAAE,KAAKjE,eAAL,CAAqBkE;AAAlC,GAA7B,CAAlB;AACA,QAAMC,WAAW,GAAGlK,WAAW,CAACwE,MAAZ,CAAmBsB,MAAnB,EAA2B,EAA3B,EAA+B;AAAEH,IAAAA;AAAF,GAA/B,CAApB;AACA,QAAMwE,MAAM,GAAG3I,MAAM,CAACgD,MAAP,CAAcsB,MAAd,CAAf;AACA,QAAMsE,qBAAqB,GAAGjI,qBAAqB,CAACqC,MAAtB,CAA6BsB,MAA7B,CAA9B;AAEA1F,EAAAA,MAAM,CAAC,IAAD,EAAO;AACX,QAAIiK,MAAJ,GAAa;AACX,aAAOvE,MAAM,CAACmC,OAAd;AACD,KAHU;;AAIX,QAAInC,MAAJ,GAAa;AACX,aAAOA,MAAM,CAACG,YAAd;AACD,KANU;;AAOX,QAAIqE,YAAJ,GAAmB;AACjB,aAAOrJ,QAAQ,CAACsJ,cAAT,CAAwBzE,MAAM,CAACkC,aAA/B,CAAP;AACD,KATU;;AAUX,QAAIwC,MAAJ,GAAa;AACX,aAAO1E,MAAM,CAACG,YAAd;AACD,KAZU;;AAaX,QAAIwE,IAAJ,GAAW;AACT,aAAO3E,MAAM,CAACG,YAAd;AACD,KAfU;;AAgBX,QAAIyE,MAAJ,GAAa;AACX,aAAO5E,MAAM,CAACgC,OAAd;AACD,KAlBU;;AAmBX,QAAI6C,GAAJ,GAAU;AACR,aAAO7E,MAAM,CAACiC,IAAd;AACD,KArBU;;AAsBX,QAAIP,QAAJ,GAAe;AACb,aAAO1B,MAAM,CAACM,SAAd;AACD,KAxBU;;AAyBX,QAAI0D,QAAJ,GAAe;AACb,aAAOA,QAAP;AACD,KA3BU;;AA4BX,QAAIc,QAAJ,GAAe;AACb,aAAO3J,QAAQ,CAACsJ,cAAT,CAAwBtJ,QAAQ,CAACiF,cAAT,CAAwBJ,MAAM,CAACM,SAA/B,EAA0CyE,SAAlE,CAAP;AACD,KA9BU;;AA+BX,QAAIC,OAAJ,GAAc;AACZ,aAAO7J,QAAQ,CAACsJ,cAAT,CAAwBtJ,QAAQ,CAACiF,cAAT,CAAwBJ,MAAM,CAACM,SAA/B,EAA0C2E,QAAlE,CAAP;AACD,KAjCU;;AAkCX,QAAIhB,SAAJ,GAAgB;AACd,aAAOA,SAAP;AACD,KApCU;;AAqCX,QAAIP,WAAJ,GAAkB;AAChB,aAAOA,WAAP;AACD,KAvCU;;AAwCX,QAAIC,OAAJ,GAAc;AACZ,aAAOA,OAAP;AACD,KA1CU;;AA2CX,QAAIC,WAAJ,GAAkB;AAChB,aAAOA,WAAP;AACD,KA7CU;;AA8CX,QAAIC,UAAJ,GAAiB;AACf,aAAOA,UAAP;AACD,KAhDU;;AAiDX,QAAIC,SAAJ,GAAgB;AACd,aAAOA,SAAP;AACD,KAnDU;;AAoDX,QAAIC,OAAJ,GAAc;AACZ,aAAOA,OAAP;AACD,KAtDU;;AAuDX,QAAIK,WAAJ,GAAkB;AAChB,aAAOA,WAAP;AACD,KAzDU;;AA0DX,QAAIC,MAAJ,GAAa;AACX,aAAOA,MAAP;AACD,KA5DU;;AA6DX,QAAIa,MAAJ,GAAa;AACX,aAAOlF,MAAM,CAACwB,OAAd;AACD,KA/DU;;AAgEX;AACA,QAAI0D,MAAJ,CAAWlH,KAAX,EAAkB;AAChBhB,MAAAA,MAAM,CAACkB,cAAP,CAAsB,IAAtB,EAA4B,QAA5B,EAAsC;AACpCF,QAAAA,KADoC;AAEpCQ,QAAAA,QAAQ,EAAE,IAF0B;AAGpCU,QAAAA,UAAU,EAAE,IAHwB;AAIpCX,QAAAA,YAAY,EAAE;AAJsB,OAAtC;AAMD,KAxEU;;AAyEX,QAAI4G,YAAJ,GAAmB;AACjB,UAAIhK,QAAQ,CAACiF,cAAT,CAAwB,KAAKE,SAA7B,EAAwCkB,OAAxC,KAAoD,MAAxD,EAAgE;AAC9D,cAAMxG,YAAY,CAAC0D,MAAb,CAAoBsB,MAApB,EAA4B,CAChC,kDADgC,EAEhC,eAFgC,CAA5B,CAAN;AAID;;AAED,aAAO,KAAKiD,aAAZ;AACD,KAlFU;;AAmFX,QAAImC,cAAJ,GAAqB;AACnB,UAAIjK,QAAQ,CAACiF,cAAT,CAAwB,KAAKE,SAA7B,EAAwCkB,OAAxC,KAAoD,MAAxD,EAAgE;AAC9D,cAAMxG,YAAY,CAAC0D,MAAb,CAAoBsB,MAApB,EAA4B,CAChC,oDADgC,EAEhC,eAFgC,CAA5B,CAAN;AAID;;AAED,aAAO,KAAKsD,eAAZ;AACD,KA5FU;;AA6FX,QAAI+B,cAAJ,GAAqB;AACnB,aAAOf,qBAAP;AACD,KA/FU;;AAgGX,QAAI3E,KAAJ,GAAY;AACV,aAAOK,MAAM,CAACoC,aAAP,GAAuBjH,QAAQ,CAACsJ,cAAT,CAAwBzE,MAAM,CAACoC,aAA/B,CAAvB,GAAuEC,SAA9E;AACD,KAlGU;;AAmGX,QAAI1C,KAAJ,CAAU3B,KAAV,EAAiB;AACfhB,MAAAA,MAAM,CAACkB,cAAP,CAAsB8B,MAAtB,EAA8B,OAA9B,EAAuC;AAAEzB,QAAAA,YAAY,EAAE,IAAhB;AAAsBW,QAAAA,UAAU,EAAE,IAAlC;AAAwCV,QAAAA,QAAQ,EAAE,IAAlD;AAAwDR,QAAAA;AAAxD,OAAvC;AACD;;AArGU,GAAP,CAAN;AAwGAlD,EAAAA,qBAAqB,CAACwK,gBAAtB,CAAuC,IAAvC,EAA6C,KAAKnF,YAAlD,EArOuB,CAuOvB;AAEA;AAEA;AACA;;AACA,QAAMoF,kBAAkB,GAAG,IAAI1C,GAAJ,EAA3B;AACA,MAAI2C,aAAa,GAAG,CAApB;;AAEA,OAAKC,UAAL,GAAkB,UAAUC,OAAV,EAAmBC,OAAO,GAAG,CAA7B,EAAgC,GAAGC,IAAnC,EAAyC;AACzD,QAAI,OAAOF,OAAP,KAAmB,UAAvB,EAAmC;AACjCA,MAAAA,OAAO,GAAG1L,iBAAiB,CAAC6L,SAAlB,CAA4BH,OAA5B,CAAV;AACD;;AACDC,IAAAA,OAAO,GAAG3L,iBAAiB,CAAC8L,IAAlB,CAAuBH,OAAvB,CAAV;AAEA,WAAOI,wBAAwB,CAACL,OAAD,EAAUC,OAAV,EAAmBC,IAAnB,EAAyB;AAAEI,MAAAA,aAAa,EAAEhG,MAAjB;AAAyBiG,MAAAA,MAAM,EAAE;AAAjC,KAAzB,CAA/B;AACD,GAPD;;AAQA,OAAKC,WAAL,GAAmB,UAAUR,OAAV,EAAmBC,OAAO,GAAG,CAA7B,EAAgC,GAAGC,IAAnC,EAAyC;AAC1D,QAAI,OAAOF,OAAP,KAAmB,UAAvB,EAAmC;AACjCA,MAAAA,OAAO,GAAG1L,iBAAiB,CAAC6L,SAAlB,CAA4BH,OAA5B,CAAV;AACD;;AACDC,IAAAA,OAAO,GAAG3L,iBAAiB,CAAC8L,IAAlB,CAAuBH,OAAvB,CAAV;AAEA,WAAOI,wBAAwB,CAACL,OAAD,EAAUC,OAAV,EAAmBC,IAAnB,EAAyB;AAAEI,MAAAA,aAAa,EAAEhG,MAAjB;AAAyBiG,MAAAA,MAAM,EAAE;AAAjC,KAAzB,CAA/B;AACD,GAPD;;AASA,OAAKE,YAAL,GAAoB,UAAUC,MAAM,GAAG,CAAnB,EAAsB;AACxCA,IAAAA,MAAM,GAAGpM,iBAAiB,CAAC8L,IAAlB,CAAuBM,MAAvB,CAAT;AAEA,UAAMC,WAAW,GAAGd,kBAAkB,CAACpG,GAAnB,CAAuBiH,MAAvB,CAApB;;AACA,QAAIC,WAAJ,EAAiB;AACfF,MAAAA,YAAY,CAACE,WAAD,CAAZ;AACAd,MAAAA,kBAAkB,CAACe,MAAnB,CAA0BF,MAA1B;AACD;AACF,GARD;;AASA,OAAKG,aAAL,GAAqB,UAAUH,MAAM,GAAG,CAAnB,EAAsB;AACzCA,IAAAA,MAAM,GAAGpM,iBAAiB,CAAC8L,IAAlB,CAAuBM,MAAvB,CAAT;AAEA,UAAMC,WAAW,GAAGd,kBAAkB,CAACpG,GAAnB,CAAuBiH,MAAvB,CAApB;;AACA,QAAIC,WAAJ,EAAiB;AACf;AACAF,MAAAA,YAAY,CAACE,WAAD,CAAZ;AACAd,MAAAA,kBAAkB,CAACe,MAAnB,CAA0BF,MAA1B;AACD;AACF,GATD;;AAWA,WAASL,wBAAT,CAAkCL,OAAlC,EAA2CC,OAA3C,EAAoDC,IAApD,EAA0D;AAAEI,IAAAA,aAAF;AAAiBC,IAAAA,MAAjB;AAAyBO,IAAAA;AAAzB,GAA1D,EAAqG;AACnG;AACA,QAAI,CAACR,aAAa,CAAC1F,SAAnB,EAA8B;AAC5B,aAAO,CAAP;AACD,KAJkG,CAMnG;;;AAEA,UAAMmG,kBAAkB,GAAGT,aAAa,CAAC7F,YAAzC;AACA,UAAMiG,MAAM,GAAGI,cAAc,KAAKnE,SAAnB,GAA+BmE,cAA/B,GAAgD,EAAEhB,aAAjE;;AAEA,aAASkB,IAAT,GAAgB;AACd,UAAI,CAACnB,kBAAkB,CAACoB,GAAnB,CAAuBP,MAAvB,CAAL,EAAqC;AACnC;AACD;;AAED,UAAI;AACF,YAAI,OAAOV,OAAP,KAAmB,UAAvB,EAAmC;AACjCA,UAAAA,OAAO,CAACkB,KAAR,CAAcH,kBAAd,EAAkCb,IAAlC;AACD,SAFD,MAEO,IAAI5F,MAAM,CAAC+B,WAAP,KAAuB,aAA3B,EAA0C;AAC/CjI,UAAAA,EAAE,CAACmE,YAAH,CAAgByH,OAAhB,EAAyB1F,MAAzB,EAAiC;AAAE6G,YAAAA,QAAQ,EAAE7G,MAAM,CAAC8E,QAAP,CAAgBgC,IAA5B;AAAkCC,YAAAA,aAAa,EAAE;AAAjD,WAAjC;AACD;AACF,OAND,CAME,OAAOC,CAAP,EAAU;AACVnL,QAAAA,eAAe,CAACmE,MAAD,EAASgH,CAAT,EAAYhH,MAAM,CAAC8E,QAAP,CAAgBgC,IAA5B,CAAf;AACD;;AAED,UAAIvB,kBAAkB,CAACoB,GAAnB,CAAuBP,MAAvB,CAAJ,EAAoC;AAClC,YAAIH,MAAJ,EAAY;AACVF,UAAAA,wBAAwB,CAACL,OAAD,EAAUC,OAAV,EAAmBC,IAAnB,EAAyB;AAAEI,YAAAA,aAAF;AAAiBC,YAAAA,MAAM,EAAE,IAAzB;AAA+BO,YAAAA,cAAc,EAAEJ;AAA/C,WAAzB,CAAxB;AACD,SAFD,MAEO;AACLb,UAAAA,kBAAkB,CAACe,MAAnB,CAA0BF,MAA1B;AACD;AACF;AACF;;AAED,QAAIT,OAAO,GAAG,CAAd,EAAiB;AACfA,MAAAA,OAAO,GAAG,CAAV;AACD;;AAED,UAAMU,WAAW,GAAGZ,UAAU,CAACiB,IAAD,EAAOf,OAAP,CAA9B;AACAJ,IAAAA,kBAAkB,CAAClG,GAAnB,CAAuB+G,MAAvB,EAA+BC,WAA/B;AAEA,WAAOD,MAAP;AACD,GAhUsB,CAkUvB;;;AAEA,OAAK9I,cAAL,GAAsB,UAAU2J,QAAV,EAAoB;AACxCA,IAAAA,QAAQ,GAAGjN,iBAAiB,CAACkN,QAAlB,CAA2BD,QAA3B,CAAX;AAEA5J,IAAAA,4BAA4B,CAAC,MAAM;AACjC,UAAI;AACF4J,QAAAA,QAAQ;AACT,OAFD,CAEE,OAAOD,CAAP,EAAU;AACVnL,QAAAA,eAAe,CAACmE,MAAD,EAASgH,CAAT,EAAYhH,MAAM,CAAC8E,QAAP,CAAgBgC,IAA5B,CAAf;AACD;AACF,KAN2B,CAA5B;AAOD,GAVD,CApUuB,CAgVvB;;;AAEA,MAAIK,wBAAwB,GAAG,CAA/B;AACA,QAAMC,4BAA4B,GAAG,IAAIvE,GAAJ,EAArC;AACA,MAAIwE,4BAA4B,GAAG,IAAnC,CApVuB,CAsVvB;AACA;;AACA,MAAIC,sCAAsC,GAAG,CAA7C;;AAEA,MAAI,KAAKhF,kBAAT,EAA6B;AAC3B,SAAKiF,qBAAL,GAA6B,UAAUN,QAAV,EAAoB;AAC/CA,MAAAA,QAAQ,GAAGjN,iBAAiB,CAACkN,QAAlB,CAA2BD,QAA3B,CAAX;AAEA,YAAMb,MAAM,GAAG,EAAEe,wBAAjB;AACAC,MAAAA,4BAA4B,CAAC/H,GAA7B,CAAiC+G,MAAjC,EAAyCa,QAAzC;AAEA,QAAEK,sCAAF;;AACA,UAAIA,sCAAsC,KAAK,CAA/C,EAAkD;AAChDD,QAAAA,4BAA4B,GAAGnB,WAAW,CAAC,MAAM;AAC/CsB,UAAAA,0BAA0B,CAAC3H,cAAc,CAACE,GAAf,KAAuBD,iBAAxB,CAA1B;AACD,SAFyC,EAEvC,OAAO,EAFgC,CAA1C;AAGD;;AAED,aAAOsG,MAAP;AACD,KAdD;;AAgBA,SAAKqB,oBAAL,GAA4B,UAAUrB,MAAV,EAAkB;AAC5CA,MAAAA,MAAM,GAAGpM,iBAAiB,CAAC,eAAD,CAAjB,CAAmCoM,MAAnC,CAAT;AAEAsB,MAAAA,4BAA4B,CAACtB,MAAD,CAA5B;AACD,KAJD;;AAMA,aAASoB,0BAAT,CAAoCzH,GAApC,EAAyC;AACvC;AACA,YAAM4H,eAAe,GAAG,CAAC,GAAGP,4BAA4B,CAACQ,IAA7B,EAAJ,CAAxB;;AACA,WAAK,MAAMxB,MAAX,IAAqBuB,eAArB,EAAsC;AACpC;AACA,YAAIP,4BAA4B,CAACT,GAA7B,CAAiCP,MAAjC,CAAJ,EAA8C;AAC5C,gBAAMa,QAAQ,GAAGG,4BAA4B,CAACjI,GAA7B,CAAiCiH,MAAjC,CAAjB;AACAsB,UAAAA,4BAA4B,CAACtB,MAAD,CAA5B;;AACA,cAAI;AACFa,YAAAA,QAAQ,CAAClH,GAAD,CAAR;AACD,WAFD,CAEE,OAAOiH,CAAP,EAAU;AACVnL,YAAAA,eAAe,CAACmE,MAAD,EAASgH,CAAT,EAAYhH,MAAM,CAAC8E,QAAP,CAAgBgC,IAA5B,CAAf;AACD;AACF;AACF;AACF;;AAED,aAASY,4BAAT,CAAsCtB,MAAtC,EAA8C;AAC5C,UAAIgB,4BAA4B,CAACT,GAA7B,CAAiCP,MAAjC,CAAJ,EAA8C;AAC5C,UAAEkB,sCAAF;;AACA,YAAIA,sCAAsC,KAAK,CAA/C,EAAkD;AAChDf,UAAAA,aAAa,CAACc,4BAAD,CAAb;AACD;AACF;;AAEDD,MAAAA,4BAA4B,CAACd,MAA7B,CAAoCF,MAApC;AACD;AACF;;AAED,WAASyB,aAAT,GAAyB;AACvB,SAAK,MAAMxB,WAAX,IAA0Bd,kBAAkB,CAACuC,MAAnB,EAA1B,EAAuD;AACrD3B,MAAAA,YAAY,CAACE,WAAD,CAAZ;AACD;;AACDd,IAAAA,kBAAkB,CAACwC,KAAnB;AAEAxB,IAAAA,aAAa,CAACc,4BAAD,CAAb;AACD;;AAED,WAASW,MAAT,CAAgBC,IAAhB,EAAsBjK,KAAtB,EAA6BkK,eAA7B,EAA8CC,QAA9C,EAAwD;AACtD,QAAIF,IAAI,KAAK5F,SAAb,EAAwB;AACtB4F,MAAAA,IAAI,GAAG,EAAP;AACD;;AACDA,IAAAA,IAAI,GAAGjO,iBAAiB,CAAC6L,SAAlB,CAA4BoC,IAA5B,CAAP;;AAEA,QAAIjK,KAAK,KAAKqE,SAAd,EAAyB;AACvBrE,MAAAA,KAAK,GAAGhE,iBAAiB,CAAC6L,SAAlB,CAA4B7H,KAA5B,CAAR;AACD;;AAEDkK,IAAAA,eAAe,GAAGlO,iBAAiB,CAACoO,OAAlB,CAA0BF,eAA1B,CAAlB;AACAC,IAAAA,QAAQ,GAAGnO,iBAAiB,CAACoO,OAAlB,CAA0BD,QAA1B,CAAX;;AAEA,UAAME,MAAM,GAAGrI,MAAM,CAACM,SAAP,CAAiBgI,aAAjB,CAA+B,QAA/B,CAAf;;AACA,UAAMC,IAAI,GAAGpN,QAAQ,CAACiF,cAAT,CAAwBiI,MAAxB,CAAb;;AAEA,QAAIJ,IAAI,KAAK,EAAb,EAAiB;AACfM,MAAAA,IAAI,CAACN,IAAL,GAAYA,IAAZ;AACD;;AACD,QAAIjK,KAAK,KAAKqE,SAAd,EAAyB;AACvBkG,MAAAA,IAAI,CAACC,cAAL,CAAoB,IAApB,EAA0B,OAA1B,EAAmCxK,KAAnC;AACD;;AACD,QAAIkK,eAAJ,EAAqB;AACnBK,MAAAA,IAAI,CAACC,cAAL,CAAoB,IAApB,EAA0B,UAA1B,EAAsC,EAAtC;AACD;;AACDD,IAAAA,IAAI,CAACE,aAAL,GAAqBN,QAArB;AAEA,WAAOE,MAAP;AACD;;AACDrL,EAAAA,MAAM,CAACkB,cAAP,CAAsB8J,MAAtB,EAA8B,WAA9B,EAA2C;AACzChK,IAAAA,KAAK,EAAE,KAAK0K,iBAAL,CAAuB/J,SADW;AAEzCJ,IAAAA,YAAY,EAAE,KAF2B;AAGzCW,IAAAA,UAAU,EAAE,KAH6B;AAIzCV,IAAAA,QAAQ,EAAE;AAJ+B,GAA3C;AAMAxB,EAAAA,MAAM,CAACkB,cAAP,CAAsB8B,MAAtB,EAA8B,QAA9B,EAAwC;AACtChC,IAAAA,KAAK,EAAEgK,MAD+B;AAEtCzJ,IAAAA,YAAY,EAAE,IAFwB;AAGtCW,IAAAA,UAAU,EAAE,KAH0B;AAItCV,IAAAA,QAAQ,EAAE;AAJ4B,GAAxC;;AAOA,WAASmK,KAAT,CAAe,GAAG/C,IAAlB,EAAwB;AACtB,UAAMgD,GAAG,GAAG5I,MAAM,CAACM,SAAP,CAAiBgI,aAAjB,CAA+B,KAA/B,CAAZ;;AACA,UAAMC,IAAI,GAAGpN,QAAQ,CAACiF,cAAT,CAAwBwI,GAAxB,CAAb;;AAEA,QAAIhD,IAAI,CAACrB,MAAL,GAAc,CAAlB,EAAqB;AACnBgE,MAAAA,IAAI,CAACC,cAAL,CAAoB,IAApB,EAA0B,OAA1B,EAAmCK,MAAM,CAACjD,IAAI,CAAC,CAAD,CAAL,CAAzC;AACD;;AACD,QAAIA,IAAI,CAACrB,MAAL,GAAc,CAAlB,EAAqB;AACnBgE,MAAAA,IAAI,CAACC,cAAL,CAAoB,IAApB,EAA0B,QAA1B,EAAoCK,MAAM,CAACjD,IAAI,CAAC,CAAD,CAAL,CAA1C;AACD;;AAED,WAAOgD,GAAP;AACD;;AACD5L,EAAAA,MAAM,CAACkB,cAAP,CAAsByK,KAAtB,EAA6B,WAA7B,EAA0C;AACxC3K,IAAAA,KAAK,EAAE,KAAK8K,gBAAL,CAAsBnK,SADW;AAExCJ,IAAAA,YAAY,EAAE,KAF0B;AAGxCW,IAAAA,UAAU,EAAE,KAH4B;AAIxCV,IAAAA,QAAQ,EAAE;AAJ8B,GAA1C;AAMAxB,EAAAA,MAAM,CAACkB,cAAP,CAAsB8B,MAAtB,EAA8B,OAA9B,EAAuC;AACrChC,IAAAA,KAAK,EAAE2K,KAD8B;AAErCpK,IAAAA,YAAY,EAAE,IAFuB;AAGrCW,IAAAA,UAAU,EAAE,KAHyB;AAIrCV,IAAAA,QAAQ,EAAE;AAJ2B,GAAvC;;AAOA,WAASuK,KAAT,CAAeC,GAAf,EAAoB;AAClB,UAAMC,KAAK,GAAGjJ,MAAM,CAACM,SAAP,CAAiBgI,aAAjB,CAA+B,OAA/B,CAAd;;AACA,UAAMC,IAAI,GAAGpN,QAAQ,CAACiF,cAAT,CAAwB6I,KAAxB,CAAb;AACAV,IAAAA,IAAI,CAACC,cAAL,CAAoB,IAApB,EAA0B,SAA1B,EAAqC,MAArC;;AAEA,QAAIQ,GAAG,KAAK3G,SAAZ,EAAuB;AACrBkG,MAAAA,IAAI,CAACC,cAAL,CAAoB,IAApB,EAA0B,KAA1B,EAAiCK,MAAM,CAACG,GAAD,CAAvC;AACD;;AAED,WAAOC,KAAP;AACD;;AACDjM,EAAAA,MAAM,CAACkB,cAAP,CAAsB6K,KAAtB,EAA6B,WAA7B,EAA0C;AACxC/K,IAAAA,KAAK,EAAE,KAAKkL,gBAAL,CAAsBvK,SADW;AAExCJ,IAAAA,YAAY,EAAE,KAF0B;AAGxCW,IAAAA,UAAU,EAAE,KAH4B;AAIxCV,IAAAA,QAAQ,EAAE;AAJ8B,GAA1C;AAMAxB,EAAAA,MAAM,CAACkB,cAAP,CAAsB8B,MAAtB,EAA8B,OAA9B,EAAuC;AACrChC,IAAAA,KAAK,EAAE+K,KAD8B;AAErCxK,IAAAA,YAAY,EAAE,IAFuB;AAGrCW,IAAAA,UAAU,EAAE,KAHyB;AAIrCV,IAAAA,QAAQ,EAAE;AAJ2B,GAAvC;AAOA,OAAKzD,WAAL,GAAmBA,WAAW,CAACiF,MAAD,CAA9B;;AAEA,OAAK9E,IAAL,GAAY,UAAUiO,GAAV,EAAe;AACzB,UAAMC,MAAM,GAAGlO,IAAI,CAACiO,GAAD,CAAnB;;AACA,QAAIC,MAAM,KAAK,IAAf,EAAqB;AACnB,YAAMpO,YAAY,CAAC0D,MAAb,CAAoBsB,MAApB,EAA4B,CAChC,uDADgC,EAEhC,uBAFgC,CAA5B,CAAN;AAID;;AACD,WAAOoJ,MAAP;AACD,GATD;;AAWA,OAAKnO,IAAL,GAAY,UAAUkO,GAAV,EAAe;AACzB,UAAMC,MAAM,GAAGnO,IAAI,CAACkO,GAAD,CAAnB;;AACA,QAAIC,MAAM,KAAK,IAAf,EAAqB;AACnB,YAAMpO,YAAY,CAAC0D,MAAb,CAAoBsB,MAApB,EAA4B,CAChC,uDADgC,EAEhC,uBAFgC,CAA5B,CAAN;AAID;;AACD,WAAOoJ,MAAP;AACD,GATD;;AAWA,OAAKC,IAAL,GAAY,YAAY;AACtB,UAAMC,OAAO,GAAGnO,QAAQ,CAACiF,cAAT,CAAwB,KAAKE,SAA7B,EAAwCiJ,eAAxD;;AACA,QAAID,OAAJ,EAAa;AACXA,MAAAA,OAAO,CAACE,KAAR;AACD;AACF,GALD;;AAOA,OAAKA,KAAL,GAAa,YAAY;AACvB;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKlF,MAAzB,EAAiC,EAAEkF,CAAnC,EAAsC;AACpC,WAAKA,CAAL,EAAQD,KAAR;AACD,KAJsB,CAMvB;;;AACArO,IAAAA,QAAQ,CAACiF,cAAT,CAAwB,IAAxB,EAA8BsJ,eAA9B,GAAgD1M,MAAM,CAAC0B,MAAP,CAAc,IAAd,CAAhD;;AAEA,QAAI,KAAK4B,SAAT,EAAoB;AAClB,UAAI,KAAKA,SAAL,CAAeqJ,IAAnB,EAAyB;AACvB,aAAKrJ,SAAL,CAAeqJ,IAAf,CAAoBC,SAApB,GAAgC,EAAhC;AACD;;AAED,UAAI,KAAKtJ,SAAL,CAAekJ,KAAnB,EAA0B;AACxB;AACA;AACArO,QAAAA,QAAQ,CAACiF,cAAT,CAAwB,KAAKE,SAA7B,EAAwCoJ,eAAxC,GAA0D1M,MAAM,CAAC0B,MAAP,CAAc,IAAd,CAA1D;;AACA,aAAK4B,SAAL,CAAekJ,KAAf;AACD;;AACD,YAAMK,GAAG,GAAG1O,QAAQ,CAACiF,cAAT,CAAwB,KAAKE,SAA7B,CAAZ;;AACA,UAAIuJ,GAAG,CAACN,eAAR,EAAyB;AACvBM,QAAAA,GAAG,CAACN,eAAJ,CAAoBC,KAApB;AACD;;AACD,aAAO,KAAKlJ,SAAZ;AACD;;AAEDuH,IAAAA,aAAa;AACbzM,IAAAA,aAAa,CAAC0O,aAAd,CAA4B,IAA5B;AACD,GA7BD;;AA+BA,OAAKC,gBAAL,GAAwB,UAAUC,GAAV,EAAeC,SAAS,GAAG5H,SAA3B,EAAsC;AAC5D2H,IAAAA,GAAG,GAAGxP,OAAO,CAACgF,OAAR,CAAgBwK,GAAhB,CAAN;;AACA,QAAIC,SAAS,KAAK5H,SAAd,IAA2B4H,SAAS,KAAK,IAA7C,EAAmD;AACjDA,MAAAA,SAAS,GAAGjQ,iBAAiB,CAAC6L,SAAlB,CAA4BoE,SAA5B,CAAZ;AACD;;AAED,QAAIA,SAAS,KAAK5H,SAAd,IAA2B4H,SAAS,KAAK,IAAzC,IAAiDA,SAAS,KAAK,EAAnE,EAAuE;AACrE;AAEA,UAAI7N,wBAAwB,CAAC8N,IAAzB,CAA8BD,SAA9B,CAAJ,EAA8C;AAC5C,cAAM,IAAI5L,SAAJ,CAAc,iEAAd,CAAN;AACD;;AAEDjE,MAAAA,cAAc,CAAC,sCAAD,EAAyC,IAAzC,CAAd;AACD;;AAED,UAAM+P,WAAW,GAAG,IAAIlQ,mBAAJ,EAApB;AACA,UAAM;AAAEmQ,MAAAA;AAAF,QAAcC,KAAK,CAAC1L,SAA1B;AACA,UAAM;AAAE2L,MAAAA;AAAF,QAAYN,GAAlB;AAEA/N,IAAAA,iCAAiC,CAAC+N,GAAD,EAAMO,IAAI,IAAI;AAC7CH,MAAAA,OAAO,CAACI,IAAR,CAAaD,IAAI,CAACD,KAAlB,EAAyBG,QAAQ,IAAI;AACnCN,QAAAA,WAAW,CAACO,WAAZ,CACED,QADF,EAEEF,IAAI,CAACD,KAAL,CAAWK,gBAAX,CAA4BF,QAA5B,CAFF,EAGEF,IAAI,CAACD,KAAL,CAAWM,mBAAX,CAA+BH,QAA/B,CAHF;AAKD,OAND;AAOD,KARgC,CAAjC,CApB4D,CA8B5D;;AACA,UAAMI,YAAY,GAAG7N,MAAM,CAAC4K,IAAP,CAAYzL,sCAAZ,CAArB;AACAiO,IAAAA,OAAO,CAACI,IAAR,CAAaK,YAAb,EAA2BJ,QAAQ,IAAI;AACrCN,MAAAA,WAAW,CAACO,WAAZ,CAAwBD,QAAxB,EAAkCvO,gBAAgB,CAAC8N,GAAD,EAAMS,QAAN,CAAlD;AACD,KAFD;AAIAL,IAAAA,OAAO,CAACI,IAAR,CAAaF,KAAb,EAAoBG,QAAQ,IAAI;AAC9BN,MAAAA,WAAW,CAACO,WAAZ,CAAwBD,QAAxB,EAAkCH,KAAK,CAACK,gBAAN,CAAuBF,QAAvB,CAAlC,EAAoEH,KAAK,CAACM,mBAAN,CAA0BH,QAA1B,CAApE;AACD,KAFD;AAIA,WAAON,WAAP;AACD,GAzCD;;AA2CA,OAAK1G,YAAL,GAAoB,YAAY;AAC9B,WAAOzD,MAAM,CAACM,SAAP,CAAiBmD,YAAjB,EAAP;AACD,GAFD,CA5lBuB,CAgmBvB;;;AACA,OAAKqH,aAAL,GAAqB,YAAY,CAAE,CAAnC;;AAEA,OAAKC,aAAL,GAAqB,YAAY,CAAE,CAAnC,CAnmBuB,CAqmBvB;;;AAEA,WAASC,iBAAT,CAA2BC,MAA3B,EAAmC;AACjC,WAAO,CAAC,GAAGrF,IAAJ,KAAa;AAClB5F,MAAAA,MAAM,CAAC6B,eAAP,CAAuBqJ,IAAvB,CAA4BD,MAA5B,EAAoC,GAAGrF,IAAvC;AACD,KAFD;AAGD;;AAED,OAAKuF,OAAL,GAAe;AACbC,IAAAA,MAAM,EAAEJ,iBAAiB,CAAC,QAAD,CADZ;AAEbjD,IAAAA,KAAK,EAAEiD,iBAAiB,CAAC,OAAD,CAFX;AAGbK,IAAAA,KAAK,EAAEL,iBAAiB,CAAC,OAAD,CAHX;AAIbM,IAAAA,UAAU,EAAEN,iBAAiB,CAAC,YAAD,CAJhB;AAKbO,IAAAA,KAAK,EAAEP,iBAAiB,CAAC,OAAD,CALX;AAMbQ,IAAAA,GAAG,EAAER,iBAAiB,CAAC,KAAD,CANT;AAObS,IAAAA,MAAM,EAAET,iBAAiB,CAAC,QAAD,CAPZ;AAQbU,IAAAA,KAAK,EAAEV,iBAAiB,CAAC,OAAD,CARX;AASbW,IAAAA,KAAK,EAAEX,iBAAiB,CAAC,OAAD,CATX;AAUbY,IAAAA,cAAc,EAAEZ,iBAAiB,CAAC,gBAAD,CAVpB;AAWba,IAAAA,QAAQ,EAAEb,iBAAiB,CAAC,UAAD,CAXd;AAYbc,IAAAA,IAAI,EAAEd,iBAAiB,CAAC,MAAD,CAZV;AAabe,IAAAA,GAAG,EAAEf,iBAAiB,CAAC,KAAD,CAbT;AAcbgB,IAAAA,KAAK,EAAEhB,iBAAiB,CAAC,OAAD,CAdX;AAebiB,IAAAA,IAAI,EAAEjB,iBAAiB,CAAC,MAAD,CAfV;AAgBbkB,IAAAA,OAAO,EAAElB,iBAAiB,CAAC,SAAD,CAhBb;AAiBbmB,IAAAA,OAAO,EAAEnB,iBAAiB,CAAC,SAAD,CAjBb;AAkBboB,IAAAA,KAAK,EAAEpB,iBAAiB,CAAC,OAAD,CAlBX;AAmBbqB,IAAAA,IAAI,EAAErB,iBAAiB,CAAC,MAAD;AAnBV,GAAf;;AAsBA,WAASsB,oBAAT,CAA8BnP,IAA9B,EAAoC;AAClC,WAAO,YAAY;AACjB/C,MAAAA,cAAc,CAAC+C,IAAD,EAAO6C,MAAP,CAAd;AACD,KAFD;AAGD;;AAED1F,EAAAA,MAAM,CAAC,IAAD,EAAO;AACX6C,IAAAA,IAAI,EAAE,EADK;AAEXoP,IAAAA,MAAM,EAAE,EAFG;AAGXC,IAAAA,gBAAgB,EAAE,CAHP;AAIXC,IAAAA,UAAU,EAAE,IAJD;AAKXC,IAAAA,WAAW,EAAE,GALF;AAMXC,IAAAA,UAAU,EAAE,IAND;AAOXC,IAAAA,WAAW,EAAE,GAPF;AAQXC,IAAAA,WAAW,EAAE,CARF;AASXC,IAAAA,WAAW,EAAE,CATF;AAUXC,IAAAA,OAAO,EAAE,CAVE;AAWXC,IAAAA,UAAU,EAAE,CAXD;AAYXC,IAAAA,OAAO,EAAE,CAZE;AAaXC,IAAAA,SAAS,EAAE,CAbA;AAcXC,IAAAA,OAAO,EAAE,CAdE;AAeXC,IAAAA,OAAO,EAAE,CAfE;AAiBXC,IAAAA,KAAK,EAAEf,oBAAoB,CAAC,cAAD,CAjBhB;AAkBXgB,IAAAA,IAAI,EAAEhB,oBAAoB,CAAC,aAAD,CAlBf;AAmBXiB,IAAAA,OAAO,EAAEjB,oBAAoB,CAAC,gBAAD,CAnBlB;AAoBXkB,IAAAA,KAAK,EAAElB,oBAAoB,CAAC,cAAD,CApBhB;AAqBXmB,IAAAA,MAAM,EAAEnB,oBAAoB,CAAC,eAAD,CArBjB;AAsBXoB,IAAAA,MAAM,EAAEpB,oBAAoB,CAAC,eAAD,CAtBjB;AAuBXqB,IAAAA,IAAI,EAAErB,oBAAoB,CAAC,aAAD,CAvBf;AAwBXsB,IAAAA,KAAK,EAAEtB,oBAAoB,CAAC,cAAD,CAxBhB;AAyBXuB,IAAAA,MAAM,EAAEvB,oBAAoB,CAAC,eAAD,CAzBjB;AA0BXwB,IAAAA,QAAQ,EAAExB,oBAAoB,CAAC,iBAAD,CA1BnB;AA2BXyB,IAAAA,QAAQ,EAAEzB,oBAAoB,CAAC,iBAAD,CA3BnB;AA4BX0B,IAAAA,MAAM,EAAE1B,oBAAoB,CAAC,eAAD,CA5BjB;AA6BX2B,IAAAA,QAAQ,EAAE3B,oBAAoB,CAAC,iBAAD,CA7BnB;AA8BX4B,IAAAA,QAAQ,EAAE5B,oBAAoB,CAAC,iBAAD;AA9BnB,GAAP,CAAN,CAzoBuB,CA0qBvB;;AAEA/O,EAAAA,OAAO,CAACC,QAAR,CAAiB,MAAM;AACrB,QAAI,CAACwC,MAAM,CAAC0B,QAAZ,EAAsB;AACpB,aADoB,CACZ;AACT;;AAED,UAAML,YAAY,GAAGlG,QAAQ,CAACiF,cAAT,CAAwBJ,MAAM,CAACM,SAA/B,CAArB;;AAEA,QAAIN,MAAM,CAAC0B,QAAP,CAAgByM,UAAhB,KAA+B,UAAnC,EAA+C;AAC7CpS,MAAAA,WAAW,CAAC,MAAD,EAASiE,MAAT,EAAiBqC,SAAjB,EAA4B,EAA5B,EAAgChB,YAAhC,CAAX;AACD,KAFD,MAEO;AACLrB,MAAAA,MAAM,CAAC0B,QAAP,CAAgB0M,gBAAhB,CAAiC,MAAjC,EAAyC,MAAM;AAC7CrS,QAAAA,WAAW,CAAC,MAAD,EAASiE,MAAT,EAAiBqC,SAAjB,EAA4B,EAA5B,EAAgChB,YAAhC,CAAX;;AAEA,YAAI,CAACA,YAAY,CAACgN,gBAAlB,EAAoC;AAClChN,UAAAA,YAAY,CAACgN,gBAAb,GAAgC,IAAhC;AACAtS,UAAAA,WAAW,CAAC,UAAD,EAAaiE,MAAb,EAAqBnF,mBAArB,EAA0C;AAAEyT,YAAAA,SAAS,EAAE;AAAb,WAA1C,EAAgEjN,YAAhE,CAAX;AACD;AACF,OAPD;AAQD;AACF,GAnBD;AAoBD;;AAED,SAASzD,gBAAT,CAA0BoC,MAA1B,EAAkC;AAChC,MAAIlG,EAAE,CAACsH,SAAH,CAAapB,MAAb,CAAJ,EAA0B;AACxB;AACD;;AAEDlG,EAAAA,EAAE,CAACyU,aAAH,CAAiBvO,MAAjB;AACD","sourcesContent":["\"use strict\";\nconst vm = require(\"vm\");\nconst webIDLConversions = require(\"webidl-conversions\");\nconst { CSSStyleDeclaration } = require(\"cssstyle\");\nconst { Performance: RawPerformance } = require(\"w3c-hr-time\");\nconst notImplemented = require(\"./not-implemented\");\nconst { installInterfaces } = require(\"../living/interfaces\");\nconst { define, mixin } = require(\"../utils\");\nconst Element = require(\"../living/generated/Element\");\nconst EventTarget = require(\"../living/generated/EventTarget\");\nconst EventHandlerNonNull = require(\"../living/generated/EventHandlerNonNull\");\nconst OnBeforeUnloadEventHandlerNonNull = require(\"../living/generated/OnBeforeUnloadEventHandlerNonNull\");\nconst OnErrorEventHandlerNonNull = require(\"../living/generated/OnErrorEventHandlerNonNull\");\nconst PageTransitionEvent = require(\"../living/generated/PageTransitionEvent\");\nconst namedPropertiesWindow = require(\"../living/named-properties-window\");\nconst postMessage = require(\"../living/post-message\");\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\nconst { btoa, atob } = require(\"abab\");\nconst idlUtils = require(\"../living/generated/utils\");\nconst WebSocketImpl = require(\"../living/websockets/WebSocket-impl\").implementation;\nconst BarProp = require(\"../living/generated/BarProp\");\nconst documents = require(\"../living/documents.js\");\nconst External = require(\"../living/generated/External\");\nconst Navigator = require(\"../living/generated/Navigator\");\nconst Performance = require(\"../living/generated/Performance\");\nconst Screen = require(\"../living/generated/Screen\");\nconst Storage = require(\"../living/generated/Storage\");\nconst Selection = require(\"../living/generated/Selection\");\nconst reportException = require(\"../living/helpers/runtime-script-errors\");\nconst { getCurrentEventHandlerValue } = require(\"../living/helpers/create-event-accessor.js\");\nconst { fireAnEvent } = require(\"../living/helpers/events\");\nconst SessionHistory = require(\"../living/window/SessionHistory\");\nconst { forEachMatchingSheetRuleOfElement, getResolvedValue, propertiesWithResolvedValueImplemented,\n  SHADOW_DOM_PSEUDO_REGEXP } = require(\"../living/helpers/style-rules.js\");\nconst CustomElementRegistry = require(\"../living/generated/CustomElementRegistry\");\nconst jsGlobals = require(\"./js-globals.json\");\n\nconst GlobalEventHandlersImpl = require(\"../living/nodes/GlobalEventHandlers-impl\").implementation;\nconst WindowEventHandlersImpl = require(\"../living/nodes/WindowEventHandlers-impl\").implementation;\n\nconst events = new Set([\n  // GlobalEventHandlers\n  \"abort\", \"autocomplete\",\n  \"autocompleteerror\", \"blur\",\n  \"cancel\", \"canplay\", \"canplaythrough\",\n  \"change\", \"click\",\n  \"close\", \"contextmenu\",\n  \"cuechange\", \"dblclick\",\n  \"drag\", \"dragend\",\n  \"dragenter\",\n  \"dragleave\", \"dragover\",\n  \"dragstart\", \"drop\",\n  \"durationchange\", \"emptied\",\n  \"ended\", \"focus\",\n  \"input\", \"invalid\",\n  \"keydown\", \"keypress\",\n  \"keyup\", \"load\", \"loadeddata\",\n  \"loadedmetadata\", \"loadstart\",\n  \"mousedown\", \"mouseenter\",\n  \"mouseleave\", \"mousemove\",\n  \"mouseout\", \"mouseover\",\n  \"mouseup\", \"wheel\",\n  \"pause\", \"play\",\n  \"playing\", \"progress\",\n  \"ratechange\", \"reset\",\n  \"resize\", \"scroll\",\n  \"securitypolicyviolation\",\n  \"seeked\", \"seeking\",\n  \"select\", \"sort\", \"stalled\",\n  \"submit\", \"suspend\",\n  \"timeupdate\", \"toggle\",\n  \"volumechange\", \"waiting\",\n\n  // WindowEventHandlers\n  \"afterprint\",\n  \"beforeprint\",\n  \"hashchange\",\n  \"languagechange\",\n  \"message\",\n  \"messageerror\",\n  \"offline\",\n  \"online\",\n  \"pagehide\",\n  \"pageshow\",\n  \"popstate\",\n  \"rejectionhandled\",\n  \"storage\",\n  \"unhandledrejection\",\n  \"unload\"\n\n  // \"error\" and \"beforeunload\" are added separately\n]);\n\nexports.createWindow = function (options) {\n  return new Window(options);\n};\n\nconst jsGlobalEntriesToInstall = Object.entries(jsGlobals).filter(([name]) => name in global);\n\n// TODO remove when we drop Node v10 support.\nconst anyNodeVersionQueueMicrotask = typeof queueMicrotask === \"function\" ? queueMicrotask : process.nextTick;\n\n// https://html.spec.whatwg.org/#the-window-object\nfunction setupWindow(windowInstance, { runScripts }) {\n  if (runScripts === \"outside-only\" || runScripts === \"dangerously\") {\n    contextifyWindow(windowInstance);\n\n    // Without this, these globals will only appear to scripts running inside the context using vm.runScript; they will\n    // not appear to scripts running from the outside, including to JSDOM implementation code.\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc, value: vm.runInContext(globalName, windowInstance) };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  } else {\n    // Without contextifying the window, none of the globals will exist. So, let's at least alias them from the Node.js\n    // context. See https://github.com/jsdom/jsdom/issues/2727 for more background and discussion.\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc, value: global[globalName] };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  }\n\n  installInterfaces(windowInstance, [\"Window\"]);\n\n  const EventTargetConstructor = windowInstance.EventTarget;\n\n  // eslint-disable-next-line func-name-matching, func-style, no-shadow\n  const windowConstructor = function Window() {\n    throw new TypeError(\"Illegal constructor\");\n  };\n  Object.setPrototypeOf(windowConstructor, EventTargetConstructor);\n\n  Object.defineProperty(windowInstance, \"Window\", {\n    configurable: true,\n    writable: true,\n    value: windowConstructor\n  });\n\n  const windowPrototype = Object.create(EventTargetConstructor.prototype);\n  Object.defineProperties(windowPrototype, {\n    constructor: {\n      value: windowConstructor,\n      writable: true,\n      configurable: true\n    },\n    [Symbol.toStringTag]: {\n      value: \"Window\",\n      configurable: true\n    }\n  });\n\n  windowConstructor.prototype = windowPrototype;\n  Object.setPrototypeOf(windowInstance, windowPrototype);\n\n  EventTarget.setup(windowInstance, windowInstance);\n  mixin(windowInstance, WindowEventHandlersImpl.prototype);\n  mixin(windowInstance, GlobalEventHandlersImpl.prototype);\n  windowInstance._initGlobalEvents();\n\n  Object.defineProperty(windowInstance, \"onbeforeunload\", {\n    configurable: true,\n    enumerable: true,\n    get() {\n      return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, \"beforeunload\"));\n    },\n    set(V) {\n      if (!idlUtils.isObject(V)) {\n        V = null;\n      } else {\n        V = OnBeforeUnloadEventHandlerNonNull.convert(V, {\n          context: \"Failed to set the 'onbeforeunload' property on 'Window': The provided value\"\n        });\n      }\n      this._setEventHandlerFor(\"beforeunload\", V);\n    }\n  });\n\n  Object.defineProperty(windowInstance, \"onerror\", {\n    configurable: true,\n    enumerable: true,\n    get() {\n      return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, \"error\"));\n    },\n    set(V) {\n      if (!idlUtils.isObject(V)) {\n        V = null;\n      } else {\n        V = OnErrorEventHandlerNonNull.convert(V, {\n          context: \"Failed to set the 'onerror' property on 'Window': The provided value\"\n        });\n      }\n      this._setEventHandlerFor(\"error\", V);\n    }\n  });\n\n  for (const event of events) {\n    Object.defineProperty(windowInstance, `on${event}`, {\n      configurable: true,\n      enumerable: true,\n      get() {\n        return idlUtils.tryWrapperForImpl(getCurrentEventHandlerValue(this, event));\n      },\n      set(V) {\n        if (!idlUtils.isObject(V)) {\n          V = null;\n        } else {\n          V = EventHandlerNonNull.convert(V, {\n            context: `Failed to set the 'on${event}' property on 'Window': The provided value`\n          });\n        }\n        this._setEventHandlerFor(event, V);\n      }\n    });\n  }\n\n  windowInstance._globalObject = windowInstance;\n}\n\n// NOTE: per https://heycam.github.io/webidl/#Global, all properties on the Window object must be own-properties.\n// That is why we assign everything inside of the constructor, instead of using a shared prototype.\n// You can verify this in e.g. Firefox or Internet Explorer, which do a good job with Web IDL compliance.\nfunction Window(options) {\n  setupWindow(this, { runScripts: options.runScripts });\n\n  const rawPerformance = new RawPerformance();\n  const windowInitialized = rawPerformance.now();\n\n  const window = this;\n\n  // ### PRIVATE DATA PROPERTIES\n\n  this._resourceLoader = options.resourceLoader;\n\n  // vm initialization is deferred until script processing is activated\n  this._globalProxy = this;\n  Object.defineProperty(idlUtils.implForWrapper(this), idlUtils.wrapperSymbol, { get: () => this._globalProxy });\n\n  // List options explicitly to be clear which are passed through\n  this._document = documents.createWrapper(window, {\n    parsingMode: options.parsingMode,\n    contentType: options.contentType,\n    encoding: options.encoding,\n    cookieJar: options.cookieJar,\n    url: options.url,\n    lastModified: options.lastModified,\n    referrer: options.referrer,\n    concurrentNodeIterators: options.concurrentNodeIterators,\n    parseOptions: options.parseOptions,\n    defaultView: this._globalProxy,\n    global: this,\n    parentOrigin: options.parentOrigin\n  }, { alwaysUseDocumentClass: true });\n\n  if (vm.isContext(window)) {\n    const documentImpl = idlUtils.implForWrapper(window._document);\n    documentImpl._defaultView = window._globalProxy = vm.runInContext(\"this\", window);\n  }\n\n  const documentOrigin = idlUtils.implForWrapper(this._document)._origin;\n  this._origin = documentOrigin;\n\n  // https://html.spec.whatwg.org/#session-history\n  this._sessionHistory = new SessionHistory({\n    document: idlUtils.implForWrapper(this._document),\n    url: idlUtils.implForWrapper(this._document)._URL,\n    stateObject: null\n  }, this);\n\n  this._virtualConsole = options.virtualConsole;\n\n  this._runScripts = options.runScripts;\n\n  // Set up the window as if it's a top level window.\n  // If it's not, then references will be corrected by frame/iframe code.\n  this._parent = this._top = this._globalProxy;\n  this._frameElement = null;\n\n  // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement implementation.\n  this._length = 0;\n\n  // https://dom.spec.whatwg.org/#window-current-event\n  this._currentEvent = undefined;\n\n  this._pretendToBeVisual = options.pretendToBeVisual;\n  this._storageQuota = options.storageQuota;\n\n  // Some properties (such as localStorage and sessionStorage) share data\n  // between windows in the same origin. This object is intended\n  // to contain such data.\n  if (options.commonForOrigin && options.commonForOrigin[documentOrigin]) {\n    this._commonForOrigin = options.commonForOrigin;\n  } else {\n    this._commonForOrigin = {\n      [documentOrigin]: {\n        localStorageArea: new Map(),\n        sessionStorageArea: new Map(),\n        windowsInSameOrigin: [this]\n      }\n    };\n  }\n\n  this._currentOriginData = this._commonForOrigin[documentOrigin];\n\n  // ### WEB STORAGE\n\n  this._localStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.localStorageArea,\n    type: \"localStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n  this._sessionStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.sessionStorageArea,\n    type: \"sessionStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n\n  // ### SELECTION\n\n  // https://w3c.github.io/selection-api/#dfn-selection\n  this._selection = Selection.createImpl(window);\n\n  // https://w3c.github.io/selection-api/#dom-window\n  this.getSelection = function () {\n    return window._selection;\n  };\n\n  // ### GETTERS\n\n  const locationbar = BarProp.create(window);\n  const menubar = BarProp.create(window);\n  const personalbar = BarProp.create(window);\n  const scrollbars = BarProp.create(window);\n  const statusbar = BarProp.create(window);\n  const toolbar = BarProp.create(window);\n  const external = External.create(window);\n  const navigator = Navigator.create(window, [], { userAgent: this._resourceLoader._userAgent });\n  const performance = Performance.create(window, [], { rawPerformance });\n  const screen = Screen.create(window);\n  const customElementRegistry = CustomElementRegistry.create(window);\n\n  define(this, {\n    get length() {\n      return window._length;\n    },\n    get window() {\n      return window._globalProxy;\n    },\n    get frameElement() {\n      return idlUtils.wrapperForImpl(window._frameElement);\n    },\n    get frames() {\n      return window._globalProxy;\n    },\n    get self() {\n      return window._globalProxy;\n    },\n    get parent() {\n      return window._parent;\n    },\n    get top() {\n      return window._top;\n    },\n    get document() {\n      return window._document;\n    },\n    get external() {\n      return external;\n    },\n    get location() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._location);\n    },\n    get history() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._history);\n    },\n    get navigator() {\n      return navigator;\n    },\n    get locationbar() {\n      return locationbar;\n    },\n    get menubar() {\n      return menubar;\n    },\n    get personalbar() {\n      return personalbar;\n    },\n    get scrollbars() {\n      return scrollbars;\n    },\n    get statusbar() {\n      return statusbar;\n    },\n    get toolbar() {\n      return toolbar;\n    },\n    get performance() {\n      return performance;\n    },\n    get screen() {\n      return screen;\n    },\n    get origin() {\n      return window._origin;\n    },\n    // The origin IDL attribute is defined with [Replaceable].\n    set origin(value) {\n      Object.defineProperty(this, \"origin\", {\n        value,\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n    },\n    get localStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\n          \"localStorage is not available for opaque origins\",\n          \"SecurityError\"\n        ]);\n      }\n\n      return this._localStorage;\n    },\n    get sessionStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\n          \"sessionStorage is not available for opaque origins\",\n          \"SecurityError\"\n        ]);\n      }\n\n      return this._sessionStorage;\n    },\n    get customElements() {\n      return customElementRegistry;\n    },\n    get event() {\n      return window._currentEvent ? idlUtils.wrapperForImpl(window._currentEvent) : undefined;\n    },\n    set event(value) {\n      Object.defineProperty(window, \"event\", { configurable: true, enumerable: true, writable: true, value });\n    }\n  });\n\n  namedPropertiesWindow.initializeWindow(this, this._globalProxy);\n\n  // ### METHODS\n\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers\n\n  // In the spec the list of active timers is a set of IDs. We make it a map of IDs to Node.js timer objects, so that\n  // we can call Node.js-side clearTimeout() when clearing, and thus allow process shutdown faster.\n  const listOfActiveTimers = new Map();\n  let latestTimerId = 0;\n\n  this.setTimeout = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n    timeout = webIDLConversions.long(timeout);\n\n    return timerInitializationSteps(handler, timeout, args, { methodContext: window, repeat: false });\n  };\n  this.setInterval = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n    timeout = webIDLConversions.long(timeout);\n\n    return timerInitializationSteps(handler, timeout, args, { methodContext: window, repeat: true });\n  };\n\n  this.clearTimeout = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n\n    const nodejsTimer = listOfActiveTimers.get(handle);\n    if (nodejsTimer) {\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n  this.clearInterval = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n\n    const nodejsTimer = listOfActiveTimers.get(handle);\n    if (nodejsTimer) {\n      // We use setTimeout() in timerInitializationSteps even for this.setInterval().\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n\n  function timerInitializationSteps(handler, timeout, args, { methodContext, repeat, previousHandle }) {\n    // This appears to be unspecced, but matches browser behavior for close()ed windows.\n    if (!methodContext._document) {\n      return 0;\n    }\n\n    // TODO: implement timer nesting level behavior.\n\n    const methodContextProxy = methodContext._globalProxy;\n    const handle = previousHandle !== undefined ? previousHandle : ++latestTimerId;\n\n    function task() {\n      if (!listOfActiveTimers.has(handle)) {\n        return;\n      }\n\n      try {\n        if (typeof handler === \"function\") {\n          handler.apply(methodContextProxy, args);\n        } else if (window._runScripts === \"dangerously\") {\n          vm.runInContext(handler, window, { filename: window.location.href, displayErrors: false });\n        }\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n\n      if (listOfActiveTimers.has(handle)) {\n        if (repeat) {\n          timerInitializationSteps(handler, timeout, args, { methodContext, repeat: true, previousHandle: handle });\n        } else {\n          listOfActiveTimers.delete(handle);\n        }\n      }\n    }\n\n    if (timeout < 0) {\n      timeout = 0;\n    }\n\n    const nodejsTimer = setTimeout(task, timeout);\n    listOfActiveTimers.set(handle, nodejsTimer);\n\n    return handle;\n  }\n\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#microtask-queuing\n\n  this.queueMicrotask = function (callback) {\n    callback = webIDLConversions.Function(callback);\n\n    anyNodeVersionQueueMicrotask(() => {\n      try {\n        callback();\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n    });\n  };\n\n  // https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#animation-frames\n\n  let animationFrameCallbackId = 0;\n  const mapOfAnimationFrameCallbacks = new Map();\n  let animationFrameNodejsInterval = null;\n\n  // Unlike the spec, where an animation frame happens every 60 Hz regardless, we optimize so that if there are no\n  // requestAnimationFrame() calls outstanding, we don't fire the timer. This helps us track that.\n  let numberOfOngoingAnimationFrameCallbacks = 0;\n\n  if (this._pretendToBeVisual) {\n    this.requestAnimationFrame = function (callback) {\n      callback = webIDLConversions.Function(callback);\n\n      const handle = ++animationFrameCallbackId;\n      mapOfAnimationFrameCallbacks.set(handle, callback);\n\n      ++numberOfOngoingAnimationFrameCallbacks;\n      if (numberOfOngoingAnimationFrameCallbacks === 1) {\n        animationFrameNodejsInterval = setInterval(() => {\n          runAnimationFrameCallbacks(rawPerformance.now() - windowInitialized);\n        }, 1000 / 60);\n      }\n\n      return handle;\n    };\n\n    this.cancelAnimationFrame = function (handle) {\n      handle = webIDLConversions[\"unsigned long\"](handle);\n\n      removeAnimationFrameCallback(handle);\n    };\n\n    function runAnimationFrameCallbacks(now) {\n      // Converting to an array is important to get a sync snapshot and thus match spec semantics.\n      const callbackHandles = [...mapOfAnimationFrameCallbacks.keys()];\n      for (const handle of callbackHandles) {\n        // This has() can be false if a callback calls cancelAnimationFrame().\n        if (mapOfAnimationFrameCallbacks.has(handle)) {\n          const callback = mapOfAnimationFrameCallbacks.get(handle);\n          removeAnimationFrameCallback(handle);\n          try {\n            callback(now);\n          } catch (e) {\n            reportException(window, e, window.location.href);\n          }\n        }\n      }\n    }\n\n    function removeAnimationFrameCallback(handle) {\n      if (mapOfAnimationFrameCallbacks.has(handle)) {\n        --numberOfOngoingAnimationFrameCallbacks;\n        if (numberOfOngoingAnimationFrameCallbacks === 0) {\n          clearInterval(animationFrameNodejsInterval);\n        }\n      }\n\n      mapOfAnimationFrameCallbacks.delete(handle);\n    }\n  }\n\n  function stopAllTimers() {\n    for (const nodejsTimer of listOfActiveTimers.values()) {\n      clearTimeout(nodejsTimer);\n    }\n    listOfActiveTimers.clear();\n\n    clearInterval(animationFrameNodejsInterval);\n  }\n\n  function Option(text, value, defaultSelected, selected) {\n    if (text === undefined) {\n      text = \"\";\n    }\n    text = webIDLConversions.DOMString(text);\n\n    if (value !== undefined) {\n      value = webIDLConversions.DOMString(value);\n    }\n\n    defaultSelected = webIDLConversions.boolean(defaultSelected);\n    selected = webIDLConversions.boolean(selected);\n\n    const option = window._document.createElement(\"option\");\n    const impl = idlUtils.implForWrapper(option);\n\n    if (text !== \"\") {\n      impl.text = text;\n    }\n    if (value !== undefined) {\n      impl.setAttributeNS(null, \"value\", value);\n    }\n    if (defaultSelected) {\n      impl.setAttributeNS(null, \"selected\", \"\");\n    }\n    impl._selectedness = selected;\n\n    return option;\n  }\n  Object.defineProperty(Option, \"prototype\", {\n    value: this.HTMLOptionElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Option\", {\n    value: Option,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Image(...args) {\n    const img = window._document.createElement(\"img\");\n    const impl = idlUtils.implForWrapper(img);\n\n    if (args.length > 0) {\n      impl.setAttributeNS(null, \"width\", String(args[0]));\n    }\n    if (args.length > 1) {\n      impl.setAttributeNS(null, \"height\", String(args[1]));\n    }\n\n    return img;\n  }\n  Object.defineProperty(Image, \"prototype\", {\n    value: this.HTMLImageElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Image\", {\n    value: Image,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Audio(src) {\n    const audio = window._document.createElement(\"audio\");\n    const impl = idlUtils.implForWrapper(audio);\n    impl.setAttributeNS(null, \"preload\", \"auto\");\n\n    if (src !== undefined) {\n      impl.setAttributeNS(null, \"src\", String(src));\n    }\n\n    return audio;\n  }\n  Object.defineProperty(Audio, \"prototype\", {\n    value: this.HTMLAudioElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Audio\", {\n    value: Audio,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  this.postMessage = postMessage(window);\n\n  this.atob = function (str) {\n    const result = atob(str);\n    if (result === null) {\n      throw DOMException.create(window, [\n        \"The string to be decoded contains invalid characters.\",\n        \"InvalidCharacterError\"\n      ]);\n    }\n    return result;\n  };\n\n  this.btoa = function (str) {\n    const result = btoa(str);\n    if (result === null) {\n      throw DOMException.create(window, [\n        \"The string to be encoded contains invalid characters.\",\n        \"InvalidCharacterError\"\n      ]);\n    }\n    return result;\n  };\n\n  this.stop = function () {\n    const manager = idlUtils.implForWrapper(this._document)._requestManager;\n    if (manager) {\n      manager.close();\n    }\n  };\n\n  this.close = function () {\n    // Recursively close child frame windows, then ourselves (depth-first).\n    for (let i = 0; i < this.length; ++i) {\n      this[i].close();\n    }\n\n    // Clear out all listeners. Any in-flight or upcoming events should not get delivered.\n    idlUtils.implForWrapper(this)._eventListeners = Object.create(null);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // It's especially important to clear out the listeners here because document.close() causes a \"load\" event to\n        // fire.\n        idlUtils.implForWrapper(this._document)._eventListeners = Object.create(null);\n        this._document.close();\n      }\n      const doc = idlUtils.implForWrapper(this._document);\n      if (doc._requestManager) {\n        doc._requestManager.close();\n      }\n      delete this._document;\n    }\n\n    stopAllTimers();\n    WebSocketImpl.cleanUpWindow(this);\n  };\n\n  this.getComputedStyle = function (elt, pseudoElt = undefined) {\n    elt = Element.convert(elt);\n    if (pseudoElt !== undefined && pseudoElt !== null) {\n      pseudoElt = webIDLConversions.DOMString(pseudoElt);\n    }\n\n    if (pseudoElt !== undefined && pseudoElt !== null && pseudoElt !== \"\") {\n      // TODO: Parse pseudoElt\n\n      if (SHADOW_DOM_PSEUDO_REGEXP.test(pseudoElt)) {\n        throw new TypeError(\"Tried to get the computed style of a Shadow DOM pseudo-element.\");\n      }\n\n      notImplemented(\"window.computedStyle(elt, pseudoElt)\", this);\n    }\n\n    const declaration = new CSSStyleDeclaration();\n    const { forEach } = Array.prototype;\n    const { style } = elt;\n\n    forEachMatchingSheetRuleOfElement(elt, rule => {\n      forEach.call(rule.style, property => {\n        declaration.setProperty(\n          property,\n          rule.style.getPropertyValue(property),\n          rule.style.getPropertyPriority(property)\n        );\n      });\n    });\n\n    // https://drafts.csswg.org/cssom/#dom-window-getcomputedstyle\n    const declarations = Object.keys(propertiesWithResolvedValueImplemented);\n    forEach.call(declarations, property => {\n      declaration.setProperty(property, getResolvedValue(elt, property));\n    });\n\n    forEach.call(style, property => {\n      declaration.setProperty(property, style.getPropertyValue(property), style.getPropertyPriority(property));\n    });\n\n    return declaration;\n  };\n\n  this.getSelection = function () {\n    return window._document.getSelection();\n  };\n\n  // The captureEvents() and releaseEvents() methods must do nothing\n  this.captureEvents = function () {};\n\n  this.releaseEvents = function () {};\n\n  // ### PUBLIC DATA PROPERTIES (TODO: should be getters)\n\n  function wrapConsoleMethod(method) {\n    return (...args) => {\n      window._virtualConsole.emit(method, ...args);\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    countReset: wrapConsoleMethod(\"countReset\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    dir: wrapConsoleMethod(\"dir\"),\n    dirxml: wrapConsoleMethod(\"dirxml\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapsed: wrapConsoleMethod(\"groupCollapsed\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeLog: wrapConsoleMethod(\"timeLog\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  function notImplementedMethod(name) {\n    return function () {\n      notImplemented(name, window);\n    };\n  }\n\n  define(this, {\n    name: \"\",\n    status: \"\",\n    devicePixelRatio: 1,\n    innerWidth: 1024,\n    innerHeight: 768,\n    outerWidth: 1024,\n    outerHeight: 768,\n    pageXOffset: 0,\n    pageYOffset: 0,\n    screenX: 0,\n    screenLeft: 0,\n    screenY: 0,\n    screenTop: 0,\n    scrollX: 0,\n    scrollY: 0,\n\n    alert: notImplementedMethod(\"window.alert\"),\n    blur: notImplementedMethod(\"window.blur\"),\n    confirm: notImplementedMethod(\"window.confirm\"),\n    focus: notImplementedMethod(\"window.focus\"),\n    moveBy: notImplementedMethod(\"window.moveBy\"),\n    moveTo: notImplementedMethod(\"window.moveTo\"),\n    open: notImplementedMethod(\"window.open\"),\n    print: notImplementedMethod(\"window.print\"),\n    prompt: notImplementedMethod(\"window.prompt\"),\n    resizeBy: notImplementedMethod(\"window.resizeBy\"),\n    resizeTo: notImplementedMethod(\"window.resizeTo\"),\n    scroll: notImplementedMethod(\"window.scroll\"),\n    scrollBy: notImplementedMethod(\"window.scrollBy\"),\n    scrollTo: notImplementedMethod(\"window.scrollTo\")\n  });\n\n  // ### INITIALIZATION\n\n  process.nextTick(() => {\n    if (!window.document) {\n      return; // window might've been closed already\n    }\n\n    const documentImpl = idlUtils.implForWrapper(window._document);\n\n    if (window.document.readyState === \"complete\") {\n      fireAnEvent(\"load\", window, undefined, {}, documentImpl);\n    } else {\n      window.document.addEventListener(\"load\", () => {\n        fireAnEvent(\"load\", window, undefined, {}, documentImpl);\n\n        if (!documentImpl._pageShowingFlag) {\n          documentImpl._pageShowingFlag = true;\n          fireAnEvent(\"pageshow\", window, PageTransitionEvent, { persisted: false }, documentImpl);\n        }\n      });\n    }\n  });\n}\n\nfunction contextifyWindow(window) {\n  if (vm.isContext(window)) {\n    return;\n  }\n\n  vm.createContext(window);\n}\n"]},"metadata":{},"sourceType":"script"}